<!-- Dashboard Tab -->
<div x-show="activeTab === 'dashboard'" x-data="dashboardTab" class="space-y-6 animate-fade-in">
    <!-- Stats Grid Skeleton -->
    <div class="grid grid-cols-3 md:grid-cols-2 lg:grid-cols-6 gap-3 md:gap-6" x-show="loading">
        <template x-for="i in 6">
            <div class="bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-gray-100 animate-pulse">
                <div class="flex items-center justify-between">
                    <div class="space-y-2">
                        <div class="h-3 w-12 bg-gray-200 rounded"></div>
                        <div class="h-6 w-20 bg-gray-200 rounded"></div>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-gray-200 hidden md:block"></div>
                </div>
            </div>
        </template>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-3 md:grid-cols-2 lg:grid-cols-6 gap-3 md:gap-6" x-show="!loading"
        x-transition:enter="transition ease-out duration-500" x-transition:enter-start="opacity-0 transform scale-95"
        x-transition:enter-end="opacity-100 transform scale-100">
        <template x-for="(stat, key) in [
            { 
                label: '총 방 개수', 
                value: stats.totalRooms, 
                icon: 'ri-door-line', 
                color: 'bg-blue-500',
                tooltip: `계약중: ${stats.occupiedRooms}개\n공실: ${stats.availableRooms}개`
            },
            { 
                label: '활성 계약', 
                value: stats.activeContracts, 
                icon: 'ri-file-text-line', 
                color: 'bg-green-500',
                tooltip: `현재 계약 진행중인 방 개수`
            },
            { 
                label: '만료 예정', 
                value: stats.expiringContracts, 
                icon: 'ri-alarm-warning-line', 
                color: 'bg-orange-500',
                tooltip: `1개월 이내 종료 예정 계약`
            },
            { 
                label: '승인 대기', 
                value: stats.pendingRequests, 
                icon: 'ri-time-line', 
                color: 'bg-yellow-500',
                tooltip: `승인 대기중인 요청 건수`
            },
            { 
                label: '월세 합계', 
                value: '₩' + Number(stats.monthlyRevenue || 0).toLocaleString(), 
                icon: 'ri-wallet-3-line', 
                color: 'bg-purple-500',
                tooltip: `현재 활성 계약의 총 월세 수입 예측`
            },
            { 
                label: '보증금 합계', 
                value: '₩' + Number(stats.totalDeposit || 0).toLocaleString(), 
                icon: 'ri-safe-2-line', 
                color: 'bg-indigo-500',
                tooltip: `현재 활성 계약의 총 보증금 합계`
            }
        ]">
            <div
                class="bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative group">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-[10px] md:text-xs font-bold text-gray-400 uppercase tracking-wider mb-1"
                            x-text="stat.label">
                        </p>
                        <h3 class="text-sm md:text-lg font-black text-gray-900 tracking-tight" x-text="stat.value">
                        </h3>
                    </div>
                    <div :class="stat.color"
                        class="w-12 h-12 rounded-xl hidden md:flex items-center justify-center text-white shadow-lg">
                        <i :class="stat.icon" class="text-2xl"></i>
                    </div>
                </div>
                <!-- Tooltip -->
                <div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 px-4 py-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-200 whitespace-pre-line z-50 shadow-xl min-w-max"
                    x-show="stat.tooltip" x-text="stat.tooltip">
                </div>
            </div>
        </template>
    </div>

    <!-- Reservations & Payments Section -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden" x-init="fetchMonthlyPayments()"
        x-data="{ 
            currentSubTab: 'monthly',
            monthlyPayments: { day1: [], day15: [], others: [] },
            contractModalOpen: false,
            selectedContract: null,
            loadingDetail: false,
            selectedBranch: '전체',
            uniqueBranches: [],
            
            getFilteredList(list) {
                if (this.selectedBranch === '전체') return list;
                return list.filter(item => item.branch_name === this.selectedBranch);
            },

            async fetchMonthlyPayments() {
                try {
                    const response = await fetch('/admin/api/monthly-payments', {
                        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
                    });
                    this.monthlyPayments = await response.json();
                    
                    // Extract unique branches from all lists
                    const allItems = [
                        ...this.monthlyPayments.day1, 
                        ...this.monthlyPayments.day15, 
                        ...this.monthlyPayments.others
                    ];
                    this.uniqueBranches = [...new Set(allItems.map(item => item.branch_name))].sort();
                    
                } catch (e) {
                    console.error('Failed to fetch monthly payments', e);
                }
            },
            async openContractModal(id) {
                if(!id) return;
                this.loadingDetail = true;
                this.contractModalOpen = true;
                this.selectedContract = null;
                try {
                    const response = await fetch(`/admin/api/contracts/${id}`, {
                        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
                    });
                    this.selectedContract = await response.json();
                } catch (e) {
                    console.error('Failed to fetch contract details', e);
                    this.contractModalOpen = false;
                } finally {
                    this.loadingDetail = false;
                }
            },
            async sendOverdueSms(contractId, phone) {
                if (!phone) {
                    window.showAlert('오류', '등록된 전화번호가 없습니다.', 'error');
                    return;
                }
                
                if (!confirm('해당 사용자에게 미납 안내 문자를 발송하시겠습니까?')) return;
                
                try {
                    const response = await fetch('/admin/api/sms/manual', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + localStorage.getItem('token') 
                        },
                        body: JSON.stringify({
                            contract_id: contractId,
                            type: 'PAYMENT_OVERDUE_STAGE1'
                        })
                    });
                    if (response.ok) {
                        window.showAlert('성공', '미납 안내 문자가 발송되었습니다.', 'success');
                    } else {
                        const err = await response.json();
                        window.showAlert('실패', err.error || '발송 중 오류가 발생했습니다.', 'error');
                    }
                } catch (e) {
                    console.error('SMS send failed', e);
                    window.showAlert('오류', '서버 통신 중 오류가 발생했습니다.', 'error');
                }
            }
         }" @open-contract-modal.window="openContractModal($event.detail.id)">

        <!-- Contract Detail Modal -->
        <div x-show="contractModalOpen" class="fixed inset-0 z-[60] overflow-y-auto" x-cloak>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity"
                    @click="contractModalOpen = false"></div>
                <div
                    class="relative bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all border border-gray-100">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-xl font-black text-gray-900">상세 정보</h3>
                        <button @click="contractModalOpen = false"
                            class="p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-400">
                            <i class="ri-close-line text-2xl"></i>
                        </button>
                    </div>
                    <div class="p-8">
                        <template x-if="loadingDetail">
                            <div class="py-12 flex flex-col items-center justify-center space-y-4">
                                <div
                                    class="w-10 h-10 border-4 border-primary/20 border-t-primary rounded-full animate-spin">
                                </div>
                                <div class="text-sm font-bold text-gray-400">정보를 불러오는 중입니다...</div>
                            </div>
                        </template>
                        <template x-if="!loadingDetail && selectedContract">
                            <div class="space-y-6">
                                <!-- Status Badge -->
                                <div class="flex justify-center">
                                    <span
                                        class="px-6 py-2 rounded-full text-sm font-black uppercase tracking-widest shadow-lg"
                                        :class="{
                                            'bg-green-500 text-white shadow-green-500/20': selectedContract.status === 'active',
                                            'bg-gray-500 text-white shadow-gray-500/20': selectedContract.status === 'completed',
                                            'bg-red-500 text-white shadow-red-500/20': selectedContract.status === 'cancelled',
                                            'bg-yellow-500 text-white shadow-yellow-500/20': selectedContract.status === 'pending'
                                          }" x-text="selectedContract.status === 'active' ? '사용중' : 
                                                  selectedContract.status === 'completed' ? '종료됨' : 
                                                  selectedContract.status === 'cancelled' ? '취소됨' : '대기중'"></span>
                                </div>

                                <div class="grid grid-cols-2 gap-8">
                                    <div class="space-y-1">
                                        <label
                                            class="text-[10px] uppercase font-black text-gray-400 tracking-wider">이름</label>
                                        <div class="text-lg font-bold text-gray-900"
                                            x-text="selectedContract.user_name"></div>
                                    </div>
                                    <div class="space-y-1 text-right">
                                        <label
                                            class="text-[10px] uppercase font-black text-gray-400 tracking-wider">호실/서비스</label>
                                        <div class="text-lg font-extrabold text-primary"
                                            x-text="selectedContract.room_name"></div>
                                    </div>
                                </div>

                                <div class="h-px bg-gray-100"></div>

                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-bold text-gray-500">지점</span>
                                        <span class="text-sm font-black text-gray-900"
                                            x-text="selectedContract.branch_name"></span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-bold text-gray-500">유형</span>
                                        <span class="text-sm font-black"
                                            :class="selectedContract.room_type === 'time_based' ? 'text-blue-600' : 'text-green-600'"
                                            x-text="selectedContract.room_type === 'time_based' ? '시간제' : '월 고정'"></span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-bold text-gray-500">기간</span>
                                        <span class="text-sm font-black text-gray-900">
                                            <span x-text="selectedContract.start_date"></span> ~ <span
                                                x-text="selectedContract.end_date"></span>
                                        </span>
                                    </div>
                                    <template x-if="selectedContract.room_type === 'time_based'">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-bold text-gray-500">시간</span>
                                            <span class="text-sm font-black text-blue-600">
                                                <span x-text="selectedContract.start_time"></span> -
                                                <span x-text="selectedContract.end_time"></span>
                                            </span>
                                        </div>
                                    </template>
                                    <template x-if="selectedContract.room_type !== 'time_based'">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-bold text-gray-500">결제일</span>
                                            <span class="text-sm font-black text-green-600">매월 <span
                                                    x-text="selectedContract.payment_day"></span>일</span>
                                        </div>
                                    </template>
                                </div>

                                <div
                                    class="p-6 bg-gray-50 rounded-3xl border border-gray-100 flex justify-between items-center">
                                    <span class="text-sm font-black text-gray-400 uppercase tracking-widest">금액</span>
                                    <div class="text-2xl font-black text-primary"
                                        x-text="`₩${selectedContract.price.toLocaleString()}`"></div>
                                </div>

                                <!-- Contact Info -->
                                <div class="bg-blue-50/50 p-4 rounded-2xl space-y-2">
                                    <div class="flex items-center gap-2 text-sm text-blue-800">
                                        <i class="ri-phone-line"></i>
                                        <span class="font-bold"
                                            x-text="selectedContract.user_phone || '전화번호 없음'"></span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-blue-800">
                                        <i class="ri-mail-line"></i>
                                        <span class="font-bold" x-text="selectedContract.user_email || '이메일 없음'"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div class="p-6 bg-gray-50 border-t border-gray-100">
                        <button @click="contractModalOpen = false"
                            class="w-full py-4 bg-gray-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-black transition-all shadow-xl shadow-black/10">
                            닫기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="px-6 py-4 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-gray-50/50">
            <div class="flex items-center gap-6 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 custom-scrollbar">
                {#
                <button @click="currentSubTab = 'time'; $nextTick(() => window.adminCalendar.updateSize())"
                    class="pb-1 transition-all shrink-0"
                    :class="currentSubTab === 'time' ? 'text-lg font-black text-gray-900 border-b-2 border-primary' : 'text-lg font-bold text-gray-400 hover:text-gray-600'">
                    시간제 예약 (달력)
                </button>
                #}
                <button @click="currentSubTab = 'monthly'; fetchMonthlyPayments()" class="pb-1 transition-all shrink-0"
                    :class="currentSubTab === 'monthly' ? 'text-lg font-black text-gray-900 border-b-2 border-primary' : 'text-lg font-bold text-gray-400 hover:text-gray-600'">
                    월별 결제일 (리스트)
                </button>
            </div>

            <!-- Branch Filter Redesign -->
            <div class="flex flex-col md:flex-row items-start md:items-center gap-3 w-full md:w-auto"
                x-show="currentSubTab === 'monthly'">
                <label class="text-[10px] md:text-xs font-bold text-gray-400 uppercase tracking-widest shrink-0">지점
                    필터</label>
                <div class="flex items-center gap-2 overflow-x-auto w-full pb-2 md:pb-0 custom-scrollbar">
                    <!-- '전체' Button -->
                    <button @click="selectedBranch = '전체'"
                        :class="selectedBranch === '전체' ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'bg-white text-gray-600 border border-gray-200 hover:border-gray-300'"
                        class="px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 whitespace-nowrap">
                        전체 지점
                    </button>
                    <!-- Branch Buttons -->
                    <template x-for="branch in uniqueBranches" :key="branch">
                        <button @click="selectedBranch = branch"
                            :class="selectedBranch === branch ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'bg-white text-gray-600 border border-gray-200 hover:border-gray-300'"
                            class="px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 whitespace-nowrap"
                            x-text="branch">
                        </button>
                    </template>
                </div>
            </div>

            {#
            <!-- Legends/Filter for Search Tab 1 (only show when 'time') -->
            <div x-show="currentSubTab === 'time'" class="flex items-center gap-4 text-xs font-medium">
                <div class="flex items-center gap-2">
                    <div
                        class="flex items-center gap-1.5 px-2 py-1 rounded-md bg-blue-50 text-blue-600 border border-blue-100">
                        <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                        시간제 예약
                    </div>
                </div>
            </div>
            #}
        </div>

        {#
        <!-- Tab 1: Calendar View -->
        <div x-show="currentSubTab === 'time'" class="p-6">
            <div id="calendar" class="fc-theme-standard font-sans text-sm" style="min-height: 700px;">
            </div>
        </div>
        #}

        <!-- Tab 2: Monthly Payment Lists -->
        <div x-show="currentSubTab === 'monthly'" x-transition class="p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- 1일 결제자 -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between pb-2 border-b-2 border-blue-100">
                        <h4 class="text-lg font-black text-gray-900 flex items-center gap-3">
                            <span
                                class="w-10 h-10 rounded-xl bg-blue-500 text-white flex items-center justify-center shadow-lg shadow-blue-500/20">01</span>
                            매월 1일 결제자
                        </h4>
                        <span class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold"
                            x-text="`${getFilteredList(monthlyPayments.day1).length}명`"></span>
                    </div>
                    <div
                        class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                        <template x-for="item in getFilteredList(monthlyPayments.day1)" :key="item.id">
                            <div @click="openContractModal(item.id)"
                                class="flex items-center justify-between p-2.5 bg-gray-50 rounded-xl border border-gray-100 hover:border-blue-200 cursor-pointer transition-colors group">
                                <div class="flex items-center gap-2.5">
                                    <div
                                        class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-400 border border-gray-100 group-hover:bg-blue-50 transition-colors">
                                        <i class="ri-user-line text-base"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-gray-900 leading-tight"
                                            x-text="item.user_name"></div>
                                        <div class="text-[11px] text-gray-400"
                                            x-text="`${item.room_name} (${item.branch_name})`"></div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-1">
                                    <div class="text-sm font-black text-blue-600"
                                        x-text="`₩${item.price.toLocaleString()}`"></div>
                                    <button @click.stop="sendOverdueSms(item.id, item.user_phone)"
                                        class="px-2 py-1 bg-red-100 text-red-600 rounded text-[10px] font-bold hover:bg-red-200 transition-colors">
                                        미납안내
                                    </button>
                                </div>
                            </div>
                        </template>
                        <template x-if="monthlyPayments.day1.length === 0">
                            <div
                                class="py-12 text-center text-gray-400 bg-gray-50/50 rounded-3xl border border-dashed border-gray-200">
                                <i class="ri-calendar-event-line text-3xl block mb-2 opacity-20"></i>
                                결제자가 없습니다
                            </div>
                        </template>
                    </div>
                </div>

                <!-- 15일 결제자 -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between pb-2 border-b-2 border-green-100">
                        <h4 class="text-lg font-black text-gray-900 flex items-center gap-3">
                            <span
                                class="w-10 h-10 rounded-xl bg-green-500 text-white flex items-center justify-center shadow-lg shadow-green-500/20">15</span>
                            매월 15일 결제자
                        </h4>
                        <span class="px-3 py-1 bg-green-50 text-green-600 rounded-full text-xs font-bold"
                            x-text="`${getFilteredList(monthlyPayments.day15).length}명`"></span>
                    </div>
                    <div
                        class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                        <template x-for="item in getFilteredList(monthlyPayments.day15)" :key="item.id">
                            <div @click="openContractModal(item.id)"
                                class="flex items-center justify-between p-2.5 bg-gray-50 rounded-xl border border-gray-100 hover:border-green-200 cursor-pointer transition-colors group">
                                <div class="flex items-center gap-2.5">
                                    <div
                                        class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-400 border border-gray-100 group-hover:bg-green-50 transition-colors">
                                        <i class="ri-user-line text-base"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-gray-900 leading-tight"
                                            x-text="item.user_name"></div>
                                        <div class="text-[11px] text-gray-400"
                                            x-text="`${item.room_name} (${item.branch_name})`"></div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-1">
                                    <div class="text-sm font-black text-green-600"
                                        x-text="`₩${item.price.toLocaleString()}`"></div>
                                    <button @click.stop="sendOverdueSms(item.id, item.user_phone)"
                                        class="px-2 py-1 bg-red-100 text-red-600 rounded text-[10px] font-bold hover:bg-red-200 transition-colors">
                                        미납안내
                                    </button>
                                </div>
                            </div>
                        </template>
                        <template x-if="monthlyPayments.day15.length === 0">
                            <div
                                class="py-12 text-center text-gray-400 bg-gray-50/50 rounded-3xl border border-dashed border-gray-200">
                                <i class="ri-calendar-event-line text-3xl block mb-2 opacity-20"></i>
                                결제자가 없습니다
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- 기타 결제일 (있는 경우에만 표시) -->
            <template x-if="monthlyPayments.others && monthlyPayments.others.length > 0">
                <div class="mt-12 pt-8 border-t border-gray-100">
                    <h4 class="text-md font-bold text-gray-400 mb-6 uppercase tracking-widest">그 외
                        결제일
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <template x-for="item in getFilteredList(monthlyPayments.others)" :key="item.id">
                            <div @click="openContractModal(item.id)"
                                class="p-2.5 bg-white border border-gray-100 rounded-xl flex items-center gap-2.5 hover:border-primary cursor-pointer transition-colors">
                                <div class="w-7 h-7 rounded-lg bg-gray-100 text-gray-600 flex items-center justify-center font-bold text-[10px]"
                                    x-text="item.payment_day"></div>
                                <div>
                                    <div class="text-xs font-bold text-gray-900" x-text="item.user_name"></div>
                                    <div class="text-[10px] text-gray-400"
                                        x-text="`${item.room_name} (${item.branch_name})`"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div class="mt-8">
        <!-- Branch Data Table Skeleton -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden" x-show="loading">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                <div class="h-6 w-32 bg-gray-200 rounded animate-pulse"></div>
            </div>
            <div class="p-6 space-y-4">
                <template x-for="i in 5">
                    <div class="flex items-center gap-4 animate-pulse">
                        <div class="h-10 w-10 bg-gray-200 rounded-lg"></div>
                        <div class="h-4 w-32 bg-gray-200 rounded"></div>
                        <div class="flex-1"></div>
                        <div class="h-4 w-20 bg-gray-200 rounded"></div>
                        <div class="h-4 w-20 bg-gray-200 rounded"></div>
                        <div class="h-4 w-20 bg-gray-200 rounded"></div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Branch Data Table -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden" x-show="!loading"
            x-transition:enter="transition ease-out duration-500" x-transition:enter-start="opacity-0 translate-y-4"
            x-transition:enter-end="opacity-100 translate-y-0">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                <h3 class="text-lg font-bold text-gray-900">지점별 상세 현황</h3>
                <p class="text-sm text-gray-500 mt-1">전체 <span x-text="branchData.length"></span>개
                    지점
                </p>
            </div>
            <div class="overflow-x-auto hidden md:block">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                지점명</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                전체 방</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                계약중</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                공실</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                방 타입</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                점유율</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                만료 예정</th>
                            <th scope="col"
                                class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                월세 합계</th>
                            <th scope="col"
                                class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                보증금 합계</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <template x-for="branch in branchData" :key="branch.id">
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center mr-3">
                                            <i class="ri-building-line text-primary"></i>
                                        </div>
                                        <div class="font-medium text-gray-900" x-text="branch.name">
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <span x-text="branch.total_rooms"></span>개
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span
                                        class="px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-blue-100 text-blue-800">
                                        <span x-text="branch.occupied_rooms"></span>개
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span
                                        class="px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-gray-100 text-gray-600">
                                        <span x-text="branch.available_rooms"></span>개
                                    </span>
                                </td>
                                <!-- Room Type Distribution -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex gap-1.5">
                                        <!-- Monthly badge -->
                                        <template x-if="branch.monthly_rooms && branch.monthly_rooms > 0">
                                            <span
                                                class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-blue-100 text-blue-700">
                                                월 <span x-text="branch.monthly_rooms"></span>
                                            </span>
                                        </template>
                                        <!-- Time-based badge -->
                                        <template x-if="branch.time_based_rooms && branch.time_based_rooms > 0">
                                            <span
                                                class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-green-100 text-green-700">
                                                시간 <span x-text="branch.time_based_rooms"></span>
                                            </span>
                                        </template>
                                        <!-- Manager badge -->
                                        <template x-if="branch.manager_rooms && branch.manager_rooms > 0">
                                            <span
                                                class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-purple-100 text-purple-700">
                                                총무 <span x-text="branch.manager_rooms"></span>
                                            </span>
                                        </template>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-blue-600 h-2 rounded-full transition-all"
                                                :style="`width: ${branch.total_monthly_rooms > 0 ? (branch.occupied_rooms / branch.total_monthly_rooms * 100) : 0}%`">
                                            </div>
                                        </div>
                                        <span class="text-xs font-medium"
                                            x-text="branch.total_monthly_rooms > 0 ? Math.round(branch.occupied_rooms / branch.total_monthly_rooms * 100) + '%' : '0%'"></span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span
                                        :class="branch.expiring_contracts > 0 ? 'px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-orange-100 text-orange-800' : 'text-sm text-gray-400'">
                                        <span x-text="branch.expiring_contracts"></span><span
                                            x-show="branch.expiring_contracts > 0">개</span>
                                        <span x-show="branch.expiring_contracts === 0">-</span>
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-blue-600">
                                    ₩<span x-text="Number(branch.monthly_revenue).toLocaleString()"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-purple-600">
                                    ₩<span x-text="Number(branch.deposit).toLocaleString()"></span>
                                </td>
                            </tr>
                        </template>
                        <!-- Total Row -->
                        <tr class="bg-gray-50 font-bold border-t-2 border-gray-300">
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900">
                                전체 합계
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                <span x-text="stats.totalRooms"></span>개
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    class="px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-blue-100 text-blue-800">
                                    <span x-text="stats.occupiedRooms"></span>개
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    class="px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-gray-100 text-gray-600">
                                    <span x-text="stats.availableRooms"></span>개
                                </span>
                            </td>
                            <!-- Room Type Distribution in Total -->
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex gap-1.5">
                                    <span
                                        class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-blue-100 text-blue-700">
                                        월 <span x-text="stats.monthlyRooms || 0"></span>
                                    </span>
                                    <span
                                        class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-green-100 text-green-700">
                                        시간 <span x-text="stats.timeBasedRooms || 0"></span>
                                    </span>
                                    <span
                                        class="px-2 py-0.5 text-[10px] font-semibold rounded-full bg-purple-100 text-purple-700">
                                        총무 <span x-text="stats.managerRooms || 0"></span>
                                    </span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                <div class="flex items-center">
                                    <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-blue-600 h-2 rounded-full transition-all"
                                            :style="`width: ${stats.totalMonthlyRooms > 0 ? (stats.occupiedRooms / stats.totalMonthlyRooms * 100) : 0}%`">
                                        </div>
                                    </div>
                                    <span class="text-xs font-medium"
                                        x-text="stats.totalMonthlyRooms > 0 ? Math.round(stats.occupiedRooms / stats.totalMonthlyRooms * 100) + '%' : '0%'"></span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    :class="stats.expiringContracts > 0 ? 'px-2.5 py-1 inline-flex text-xs font-bold rounded-full bg-orange-100 text-orange-800' : 'text-sm text-gray-400'">
                                    <span x-text="stats.expiringContracts"></span><span
                                        x-show="stats.expiringContracts > 0">개</span>
                                    <span x-show="stats.expiringContracts === 0">-</span>
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-blue-600">
                                ₩<span x-text="Number(stats.monthlyRevenue).toLocaleString()"></span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-purple-600">
                                ₩<span x-text="Number(stats.totalDeposit).toLocaleString()"></span>
                            </td>
                        </tr>
                        <template x-if="branchData.length === 0">
                            <tr>
                                <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                                    <i class="ri-building-line text-4xl block mb-2 opacity-20"></i>
                                    등록된 지점이 없습니다
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div class="block md:hidden p-4 space-y-4 bg-gray-50/30">
                <template x-for="branch in branchData" :key="branch.id">
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 space-y-4">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
                                    <i class="ri-building-line text-primary text-xl"></i>
                                </div>
                                <div class="font-black text-gray-900 text-base" x-text="branch.name"></div>
                            </div>
                            <span
                                :class="branch.expiring_contracts > 0 ? 'bg-orange-100 text-orange-600' : 'bg-gray-100 text-gray-400'"
                                class="px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider"
                                x-text="branch.expiring_contracts > 0 ? `만료 ${branch.expiring_contracts}건` : '안정적'"></span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 pt-2">
                            <div class="space-y-1">
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">계약중 / 전체</p>
                                <p class="text-sm font-black text-gray-900">
                                    <span class="text-blue-600" x-text="branch.occupied_rooms"></span> / <span
                                        x-text="branch.total_rooms"></span>개
                                </p>
                            </div>
                            <div class="space-y-1 text-right">
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">점유율</p>
                                <p class="text-sm font-black text-gray-900"
                                    x-text="branch.total_monthly_rooms > 0 ? Math.round(branch.occupied_rooms / branch.total_monthly_rooms * 100) + '%' : '0%'">
                                </p>
                            </div>
                            <div class="space-y-1">
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">월세 합계</p>
                                <p class="text-sm font-black text-blue-600"
                                    x-text="'₩' + Number(branch.monthly_revenue).toLocaleString()"></p>
                            </div>
                            <div class="space-y-1 text-right">
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">보증금 합계</p>
                                <p class="text-sm font-black text-purple-600"
                                    x-text="'₩' + Number(branch.deposit).toLocaleString()"></p>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="h-1.5 w-full bg-gray-100 rounded-full overflow-hidden">
                            <div class="bg-primary h-full rounded-full transition-all duration-500"
                                :style="`width: ${branch.total_monthly_rooms > 0 ? (branch.occupied_rooms / branch.total_monthly_rooms * 100) : 0}%`">
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Total Summary Card Mobile -->
                <div class="bg-gray-900 rounded-2xl p-6 shadow-xl space-y-5 text-white">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center">
                            <i class="ri-pie-chart-line text-white text-xl"></i>
                        </div>
                        <div class="font-black text-lg">전체 합계</div>
                    </div>

                    <div class="grid grid-cols-2 gap-y-4 gap-x-6">
                        <div class="space-y-0.5">
                            <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest">전체 점유</p>
                            <p class="text-base font-black"><span x-text="stats.occupiedRooms"></span> / <span
                                    x-text="stats.totalRooms"></span>개</p>
                        </div>
                        <div class="space-y-0.5 text-right">
                            <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest">평균 점유율</p>
                            <p class="text-base font-black"
                                x-text="stats.totalMonthlyRooms > 0 ? Math.round(stats.occupiedRooms / stats.totalMonthlyRooms * 100) + '%' : '0%'">
                            </p>
                        </div>
                        <div class="col-span-2 h-px bg-white/10"></div>
                        <div class="space-y-0.5">
                            <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest">전체 월세</p>
                            <p class="text-lg font-black text-blue-400"
                                x-text="'₩' + Number(stats.monthlyRevenue).toLocaleString()"></p>
                        </div>
                        <div class="space-y-0.5 text-right">
                            <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest">전체 보증금</p>
                            <p class="text-lg font-black text-purple-400"
                                x-text="'₩' + Number(stats.totalDeposit).toLocaleString()"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>