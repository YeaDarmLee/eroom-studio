<!-- Requests Tab (Services/Repairs for active tenants) -->
<div x-show="activeTab === 'requests'" x-data="requestsTab" class="space-y-6">
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="px-4 md:px-6 pt-4 pb-5 border-b border-gray-100 flex flex-col gap-4 bg-gray-50/50">
            <div>
                <h3 class="text-base md:text-lg font-bold text-gray-900">요청 관리</h3>
                <p class="text-xs md:text-sm text-gray-500 mt-0.5">입주민들의 수리 및 비품 요청 내역입니다.</p>
            </div>
            <!-- Branch Filter -->
            <div class="flex items-center gap-2">
                <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest shrink-0">지점 필터</span>
                <div class="flex items-center gap-2 overflow-x-auto custom-scrollbar pb-1">
                    <button @click="filterBranchId = 'all'"
                        :class="{'bg-primary text-white shadow-md': filterBranchId === 'all', 'bg-white text-gray-500 hover:bg-gray-100 border border-gray-100': filterBranchId !== 'all'}"
                        class="px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap shrink-0">
                        전체 지점
                    </button>
                    <template x-for="branch in branches" :key="branch.id">
                        <button @click="filterBranchId = branch.id"
                            :class="{'bg-primary text-white shadow-md': filterBranchId == branch.id, 'bg-white text-gray-500 hover:bg-gray-100 border border-gray-100': filterBranchId != branch.id}"
                            class="px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap shrink-0"
                            x-text="branch.name">
                        </button>
                    </template>
                </div>
            </div>
        </div>
        <ul class="divide-y divide-gray-100">
            <template x-for="req in requests" :key="req.id">
                <li class="px-4 md:px-6 py-4 md:py-6 hover:bg-gray-50/50 transition-colors">
                    <div class="flex items-start gap-3">
                        <!-- Icon -->
                        <div class="flex-shrink-0 h-10 w-10 rounded-xl flex items-center justify-center text-xl shadow-sm"
                            :class="{
                                'bg-red-50 text-red-600': req.type === 'repair',
                                'bg-blue-50 text-blue-600': req.type === 'supplies',
                                'bg-green-50 text-green-600': req.type === 'extension',
                                'bg-orange-50 text-orange-600': req.type === 'termination',
                                'bg-yellow-50 text-yellow-600': req.type === 'complaint',
                                'bg-gray-50 text-gray-600': req.type === 'other'
                            }">
                            <i :class="{
                                'ri-tools-line': req.type === 'repair',
                                'ri-shopping-cart-line': req.type === 'supplies',
                                'ri-calendar-event-line': req.type === 'extension',
                                'ri-logout-box-line': req.type === 'termination',
                                'ri-megaphone-line': req.type === 'complaint',
                                'ri-question-line': req.type === 'other'
                            }"></i>
                        </div>
                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center flex-wrap gap-1.5">
                                <h4 class="text-sm font-bold text-gray-900" x-text="getTypeLabel(req.type)"></h4>
                                <span class="px-2 py-0.5 inline-flex text-[10px] font-bold rounded-full border"
                                    :class="getStatusBadgeClass(req.status)" x-text="getStatusLabel(req.status)">
                                </span>
                                <span class="text-[10px] text-primary font-bold bg-primary/5 px-1.5 py-0.5 rounded"
                                    x-text="req.room_name"></span>
                            </div>
                            <div class="flex flex-col gap-2 mt-2">
                                <!-- Extension Info -->
                                <template x-if="req.type === 'extension'">
                                    <div
                                        class="bg-primary/5 px-3 py-2 rounded-lg border border-primary/10 flex items-center justify-between">
                                        <span class="text-xs font-black text-primary uppercase">신청 연장 기간</span>
                                        <span class="text-sm font-bold text-primary"
                                            x-text="req.details.extension_months + '개월'"></span>
                                    </div>
                                </template>
                                <!-- Termination Info -->
                                <template x-if="req.type === 'termination' && req.details.termination_date">
                                    <div
                                        class="bg-orange-50 px-3 py-2 rounded-lg border border-orange-100 flex items-center justify-between">
                                        <span class="text-xs font-black text-orange-600 uppercase">신청 해지 날짜</span>
                                        <span class="text-sm font-bold text-orange-600 whitespace-nowrap"
                                            x-text="req.details.termination_date"></span>
                                    </div>
                                </template>
                                <!-- Message -->
                                <div class="text-xs text-gray-700 bg-gray-50 p-3 rounded-lg border border-gray-100 italic"
                                    x-text="req.details.message || req.details.raw || '내용 없음'">
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-2">
                                <p class="text-[11px] text-gray-500">
                                    <span class="font-medium text-gray-700" x-text="req.user_name"></span> •
                                    <span x-text="req.created_at"></span>
                                </p>
                                <!-- Action buttons -->
                                <div class="flex items-center gap-2">
                                    <template x-if="req.status === 'submitted'">
                                        <button @click="updateStatus(req.id, 'processing')"
                                            class="px-3 py-1.5 text-xs font-bold rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-all">
                                            접수하기
                                        </button>
                                    </template>
                                    <template x-if="req.status === 'processing'">
                                        <button @click="updateStatus(req.id, 'done')"
                                            class="px-3 py-1.5 text-xs font-bold rounded-lg text-white bg-green-600 hover:bg-green-700 transition-all">
                                            완료 처리
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </template>
            <template x-if="requests.length === 0">
                <li class="px-6 py-16 text-center text-gray-500">
                    <i class="ri-inbox-line text-4xl block mb-2 opacity-20"></i>
                    현재 처리할 요청 내역이 없습니다.
                </li>
            </template>
        </ul>
    </div>
</div>