<!-- Requests Tab (Services/Repairs for active tenants) -->
<div x-show="activeTab === 'requests'" x-data="requestsTab" class="space-y-6">
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-100 flex flex-col gap-4 bg-gray-50/50">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-bold text-gray-900">요청 관리</h3>
                    <p class="text-sm text-gray-500 mt-1">입주민들의 수리 및 비품 요청 내역입니다.</p>
                </div>
                <button @click="loadRequests(); loadBranches();"
                    class="text-gray-400 hover:text-primary transition-colors">
                    <i class="ri-refresh-line text-xl" :class="{'animate-spin': loading}"></i>
                </button>
            </div>
            <!-- Branch Filter -->
            <div class="flex items-center gap-4">
                <span class="text-xs font-black text-gray-400 uppercase tracking-widest">지점
                    필터</span>
                <div class="flex flex-wrap gap-2">
                    <button @click="filterBranchId = 'all'"
                        :class="{'bg-primary text-white shadow-md': filterBranchId === 'all', 'bg-white text-gray-500 hover:bg-gray-100 border border-gray-100': filterBranchId !== 'all'}"
                        class="px-3 py-1 rounded-full text-xs font-bold transition-all">
                        전체 지점
                    </button>
                    <template x-for="branch in branches" :key="branch.id">
                        <button @click="filterBranchId = branch.id"
                            :class="{'bg-primary text-white shadow-md': filterBranchId == branch.id, 'bg-white text-gray-500 hover:bg-gray-100 border border-gray-100': filterBranchId != branch.id}"
                            class="px-3 py-1 rounded-full text-xs font-bold transition-all" x-text="branch.name">
                        </button>
                    </template>
                </div>
            </div>
        </div>
        <ul class="divide-y divide-gray-200">
            <template x-for="req in requests" :key="req.id">
                <li class="px-6 py-6 hover:bg-gray-50/50 transition-colors">
                    <div class="flex flex-col md:flex-row md:items-start justify-between gap-4">
                        <div class="flex items-start flex-1 min-w-0">
                            <div class="flex-shrink-0 h-12 w-12 rounded-xl flex items-center justify-center text-2xl shadow-sm"
                                :class="{
                                    'bg-red-50 text-red-600': req.type === 'repair',
                                    'bg-blue-50 text-blue-600': req.type === 'supplies',
                                    'bg-green-50 text-green-600': req.type === 'extension',
                                    'bg-orange-50 text-orange-600': req.type === 'termination',
                                    'bg-yellow-50 text-yellow-600': req.type === 'complaint',
                                    'bg-gray-50 text-gray-600': req.type === 'other'
                                }">
                                <i :class="{
                                    'ri-tools-line': req.type === 'repair',
                                    'ri-shopping-cart-line': req.type === 'supplies',
                                    'ri-calendar-event-line': req.type === 'extension',
                                    'ri-logout-box-line': req.type === 'termination',
                                    'ri-megaphone-line': req.type === 'complaint',
                                    'ri-question-line': req.type === 'other'
                                }"></i>
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex items-center flex-wrap gap-2">
                                    <h4 class="text-base font-bold text-gray-900" x-text="getTypeLabel(req.type)"></h4>
                                    <span class="px-2.5 py-0.5 inline-flex text-xs font-bold rounded-full border"
                                        :class="getStatusBadgeClass(req.status)" x-text="getStatusLabel(req.status)">
                                    </span>
                                    <span class="text-xs text-primary font-bold bg-primary/5 px-2 py-0.5 rounded"
                                        x-text="req.room_name"></span>
                                </div>
                                <div class="flex flex-col gap-2 mt-2">
                                    <!-- Extension Info -->
                                    <template x-if="req.type === 'extension'">
                                        <div
                                            class="bg-primary/5 px-3 py-2 rounded-lg border border-primary/10 flex items-center justify-between">
                                            <span class="text-xs font-black text-primary uppercase">신청
                                                연장 기간</span>
                                            <span class="text-sm font-bold text-primary"
                                                x-text="req.details.extension_months + '개월'"></span>
                                        </div>
                                    </template>

                                    <!-- Message -->
                                    <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded-lg border border-gray-100 italic"
                                        x-text="req.details.message || req.details.raw || '내용 없음'">
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">
                                    <span class="font-medium text-gray-700" x-text="req.user_name"></span> •
                                    <span x-text="req.created_at"></span>
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 shrink-0">
                            <template x-if="req.status === 'submitted'">
                                <button @click="updateStatus(req.id, 'processing')"
                                    class="px-4 py-2 border border-transparent text-sm font-bold rounded-xl shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none transition-all">
                                    접수하기
                                </button>
                            </template>
                            <template x-if="req.status === 'processing'">
                                <button @click="updateStatus(req.id, 'done')"
                                    class="px-4 py-2 border border-transparent text-sm font-bold rounded-xl shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none transition-all">
                                    완료 처리
                                </button>
                            </template>
                        </div>
                    </div>
                </li>
            </template>
            <template x-if="requests.length === 0">
                <li class="px-6 py-16 text-center text-gray-500">
                    <i class="ri-inbox-line text-4xl block mb-2 opacity-20"></i>
                    현재 처리할 요청 내역이 없습니다.
                </li>
            </template>
        </ul>
    </div>
</div>