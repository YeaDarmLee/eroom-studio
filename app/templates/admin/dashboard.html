<!-- FIXED VERSION: 2025-12-03 (Modular Alpine.js Architecture) -->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연습실 관리 시스템 - 관리자 대시보드</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='logo/eroom_logo.svg') }}">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <!-- Fonts -->
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <!-- Custom JS Components (must load BEFORE Alpine.js) -->
    <script>
        window.showAlert = function (title, message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 translate-y-10 opacity-0 z-50 flex items-center gap-3 font-sans`;

            if (type === 'success') toast.classList.add('bg-green-500');
            else if (type === 'error') toast.classList.add('bg-red-500');
            else if (type === 'warning') toast.classList.add('bg-yellow-500');
            else toast.classList.add('bg-blue-500');

            toast.innerHTML = `
                <i class="${type === 'success' ? 'ri-checkbox-circle-line' : type === 'error' ? 'ri-error-warning-line' : 'ri-information-line'} text-xl"></i>
                <div>
                    <h4 class="font-bold text-sm">${title}</h4>
                    <p class="text-xs opacity-90">${message}</p>
                </div>
            `;

            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            });

            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
    <script src="{{ url_for('static', filename='js/admin/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/contracts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/requests.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/branches.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/users.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/coupons.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/sms.js') }}"></script>


    <!-- Alpine.js MUST be loaded AFTER custom components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3b82f6', secondary: '#8b5cf6' },
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans" x-data="adminApp" x-cloak>
    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar -->
        {% include 'admin/partials/sidebar.html' %}

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden relative">
            <!-- Header -->
            {% include 'admin/partials/header.html' %}

            <!-- Content Area -->
            <div class="flex-1 overflow-auto bg-gray-50 p-6 relative">

                <!-- Dashboard Tab -->
                {% include 'admin/partials/tab_dashboard.html' %}


                <!-- Users Tab -->
                {% include 'admin/partials/tab_users.html' %}

                <!-- Contracts Tab -->
                {% include 'admin/partials/tab_contracts.html' %}



                <!-- Coupons Tab -->
                {% include 'admin/partials/tab_coupons.html' %}

                <!-- Requests Tab -->
                {% include 'admin/partials/tab_requests.html' %}

                <!-- Inquiries Tab -->
                {% include 'admin/partials/tab_inquiries.html' %}

                <!-- Branches Tab -->
                {% include 'admin/partials/tab_branches.html' %}

                <!-- SMS Tab -->
                {% include 'admin/partials/tab_sms.html' %}
            </div>
        </main>
    </div>

    <!-- Global Modals -->
    {% include 'admin/partials/global_modals.html' %}
    <style>
        /* Custom FullCalendar Styling */
        #calendar {
            --fc-border-color: #f3f4f6;
            --fc-button-text-color: #4b5563;
            --fc-button-bg-color: #ffffff;
            --fc-button-border-color: #e5e7eb;
            --fc-button-hover-bg-color: #f9fafb;
            --fc-button-hover-border-color: #d1d5db;
            --fc-button-active-bg-color: #eff6ff;
            --fc-button-active-border-color: #3b82f6;
            --fc-event-bg-color: #3b82f6;
            --fc-event-border-color: #3b82f6;
            --fc-today-bg-color: #eff6ff;
            --fc-neutral-bg-color: #f9fafb;
        }

        .fc .fc-toolbar.fc-header-toolbar {
            margin-bottom: 1.5rem;
        }

        .fc .fc-toolbar-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #111827;
        }

        .fc .fc-button {
            border-radius: 0.75rem;
            /* rounded-xl */
            font-weight: 600;
            padding: 0.5rem 1rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active,
        .fc .fc-button-primary:not(:disabled):active {
            background-color: var(--fc-button-active-bg-color);
            border-color: var(--fc-button-active-border-color);
            color: #1d4ed8;
        }

        .fc .fc-col-header-cell-cushion {
            padding: 12px 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .fc-theme-standard .fc-scrollgrid {
            border: 1px solid var(--fc-border-color);
            border-radius: 1rem;
            /* rounded-2xl */
            overflow: hidden;
        }

        .fc-theme-standard td,
        .fc-theme-standard th {
            border-color: var(--fc-border-color);
        }

        .fc-daygrid-day-number {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            padding: 8px 12px;
        }

        /* Round events */
        .fc-event {
            border-radius: 6px;
            border: none;
            padding: 2px 4px;
            font-size: 0.75rem;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            white-space: normal !important;
        }

        .fc-daygrid-event-dot {
            border-width: 3px;
            margin-right: 6px;
        }

        /* More link */
        .fc-daygrid-more-link {
            font-weight: 600;
            color: #6b7280;
            border-radius: 4px;
            padding: 1px 4px;
        }

        .fc-daygrid-more-link:hover {
            background-color: #f3f4f6;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            if (!calendarEl) return;
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                buttonText: {
                    today: '오늘',
                    month: '월',
                    week: '주',
                    list: '목록'
                },
                events: function (info, successCallback, failureCallback) {
                    // 시간제 전용 달력이므로 type=time 고정
                    const url = `/admin/api/calendar/events?start=${info.startStr}&end=${info.endStr}&type=time`;
                    fetch(url, {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('token')
                        }
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            successCallback(data);
                        })
                        .catch(error => {
                            console.error('Error fetching calendar events:', error);
                            failureCallback(error);
                        });
                },
                eventDidMount: function (info) {
                    if (info.event.extendedProps.amount) {
                        info.el.title = info.event.title + ' (₩' + info.event.extendedProps.amount.toLocaleString() + ')';
                    }
                },
                dayMaxEvents: true,
                height: 'auto',
                eventClick: function (info) {
                    const id = info.event.extendedProps.contract_id;
                    if (id) {
                        window.dispatchEvent(new CustomEvent('open-contract-modal', { detail: { id: id } }));
                    }
                }
            });

            calendar.render();
            window.adminCalendar = calendar;
        });
    </script>
</body>

</html>