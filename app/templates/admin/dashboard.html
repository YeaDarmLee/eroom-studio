<!-- FIXED VERSION: 2025-12-03 (Modular Alpine.js Architecture) -->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연습실 관리 시스템 - 관리자 대시보드</title>

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Custom JS Components -->
    <script src="{{ url_for('static', filename='js/admin/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/contracts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/requests.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin/branches.js') }}"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3b82f6', secondary: '#8b5cf6' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans" x-data="adminApp" x-cloak>
    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar -->
        <aside class="hidden lg:flex lg:flex-shrink-0 transition-all duration-300"
            :class="sidebarOpen ? 'w-64' : 'w-20'">
            <div class="flex flex-col w-full bg-white border-r border-gray-200 shadow-sm">
                <div class="flex items-center justify-center h-16 px-4 border-b border-gray-200">
                    <h1 class="text-2xl font-bold text-primary" style="font-family: 'Pacifico', cursive;"
                        x-show="sidebarOpen || true">Eroom</h1>
                </div>
                <nav class="flex-1 px-3 py-4 space-y-2 overflow-y-auto">
                    <template x-for="item in [
                        { id: 'dashboard', icon: 'ri-dashboard-line', label: '대시보드' },
                        { id: 'contracts', icon: 'ri-file-list-line', label: '계약 관리' },
                        { id: 'requests', icon: 'ri-question-answer-line', label: '요청 관리' },
                        { id: 'branches', icon: 'ri-building-2-line', label: '지점 관리' }
                    ]">
                        <a href="#" @click.prevent="activeTab = item.id"
                            :class="{'bg-primary/10 text-primary': activeTab === item.id, 'text-gray-600 hover:bg-gray-50 hover:text-gray-900': activeTab !== item.id}"
                            class="flex items-center px-3 py-2.5 rounded-xl transition-all duration-200 group">
                            <i :class="item.icon" class="text-xl"></i>
                            <span class="ml-3 font-medium" x-text="item.label"></span>
                        </a>
                    </template>
                </nav>
                <div class="p-4 border-t border-gray-200">
                    <div class="flex items-center space-x-3 px-2 py-2 rounded-lg hover:bg-gray-50 cursor-pointer"
                        @click="logout()">
                        <div
                            class="w-8 h-8 bg-gradient-to-tr from-primary to-secondary rounded-full flex items-center justify-center text-white shadow-md">
                            <i class="ri-user-line"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate" x-text="user.name"></p>
                            <p class="text-xs text-gray-500 truncate" x-text="user.email"></p>
                        </div>
                        <i class="ri-logout-box-r-line text-gray-400 hover:text-red-500 transition-colors"></i>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden relative">
            <!-- Header -->
            <header class="bg-white/80 backdrop-blur-md sticky top-0 z-30 border-b border-gray-200 px-6 py-4 shadow-sm">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button @click="sidebarOpen = !sidebarOpen"
                            class="text-gray-500 hover:text-gray-700 focus:outline-none lg:hidden">
                            <i class="ri-menu-line text-2xl"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-900 capitalize" x-text="{
                                'dashboard': '대시보드',
                                'contracts': '계약 관리',
                                'requests': '요청 관리',
                                'branches': '지점 관리'
                            }[activeTab]">
                        </h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/"
                            class="text-sm font-medium text-gray-500 hover:text-primary transition-colors">메인으로</a>
                        <div class="h-8 w-px bg-gray-200"></div>
                        <button class="relative p-2 text-gray-400 hover:text-gray-500">
                            <i class="ri-notification-3-line text-xl"></i>
                            <span
                                class="absolute top-1.5 right-1.5 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="flex-1 overflow-auto bg-gray-50 p-6 relative">

                <!-- Dashboard Tab -->
                <div x-show="activeTab === 'dashboard'" x-data="dashboardTab" class="space-y-6 animate-fade-in">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <template x-for="(stat, key) in [
                            { label: '총 사용자', value: stats.totalUsers, icon: 'ri-user-smile-line', color: 'bg-blue-500' },
                            { label: '활성 계약', value: stats.activeContracts, icon: 'ri-file-text-line', color: 'bg-green-500' },
                            { label: '대기 요청', value: stats.pendingRequests, icon: 'ri-time-line', color: 'bg-yellow-500' },
                            { label: '이번 달 매출', value: '₩' + stats.monthlyRevenue.toLocaleString(), icon: 'ri-money-won-circle-line', color: 'bg-purple-500' }
                        ]">
                            <div
                                class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500" x-text="stat.label"></p>
                                        <p class="text-2xl font-bold text-gray-900 mt-1" x-text="stat.value"></p>
                                    </div>
                                    <div :class="stat.color"
                                        class="w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg shadow-opacity-20">
                                        <i :class="stat.icon" class="text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Charts Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">월별 매출 추이</h3>
                            <div id="revenueChart" class="w-full h-80"></div>
                        </div>
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">방 점유율</h3>
                            <div id="roomStatusChart" class="w-full h-80"></div>
                        </div>
                    </div>
                </div>

                <!-- Contracts Tab -->
                <div x-show="activeTab === 'contracts'" x-data="contractsTab" class="space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                            <div class="flex space-x-2">
                                <template x-for="status in ['all', 'active', 'requested', 'terminated']">
                                    <button @click="filterStatus = status"
                                        :class="{'bg-white shadow text-primary ring-1 ring-black/5': filterStatus === status, 'text-gray-500 hover:text-gray-700': filterStatus !== status}"
                                        class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all capitalize"
                                        x-text="status === 'all' ? '전체' : getStatusLabel(status)">
                                    </button>
                                </template>
                            </div>
                            <button @click="loadContracts()" class="text-gray-400 hover:text-primary transition-colors">
                                <i class="ri-refresh-line text-xl" :class="{'animate-spin': loading}"></i>
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            계약 ID</th>
                                        <th scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            사용자</th>
                                        <th scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            방 정보</th>
                                        <th scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            기간</th>
                                        <th scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            상태</th>
                                        <th scope="col"
                                            class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            관리</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="contract in filteredContracts" :key="contract.id">
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                                                x-text="'#' + contract.id"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div
                                                        class="h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold mr-3">
                                                        <span x-text="contract.user_name.charAt(0)"></span>
                                                    </div>
                                                    <div class="text-sm font-medium text-gray-900"
                                                        x-text="contract.user_name"></div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                                                x-text="contract.room_name"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <span x-text="contract.start_date"></span> ~ <span
                                                    x-text="contract.end_date"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span
                                                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                    :class="getStatusBadgeClass(contract.status)"
                                                    x-text="getStatusLabel(contract.status)">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <template x-if="contract.status === 'requested'">
                                                    <button @click="updateStatus(contract.id, 'active')"
                                                        class="text-green-600 hover:text-green-900 mr-3">승인</button>
                                                </template>
                                                <template x-if="contract.status === 'active'">
                                                    <button @click="updateStatus(contract.id, 'terminated')"
                                                        class="text-red-600 hover:text-red-900">종료</button>
                                                </template>
                                            </td>
                                        </tr>
                                    </template>
                                    <template x-if="filteredContracts.length === 0">
                                        <tr>
                                            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                                데이터가 없습니다.
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Requests Tab -->
                <div x-show="activeTab === 'requests'" x-data="requestsTab" class="space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                            <h3 class="text-lg font-medium text-gray-900">요청 목록</h3>
                            <button @click="loadRequests()" class="text-gray-400 hover:text-primary transition-colors">
                                <i class="ri-refresh-line text-xl" :class="{'animate-spin': loading}"></i>
                            </button>
                        </div>
                        <ul class="divide-y divide-gray-200">
                            <template x-for="req in requests" :key="req.id">
                                <li class="px-6 py-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center text-xl"
                                                :class="{
                                                    'bg-red-100 text-red-600': req.type === 'repair',
                                                    'bg-blue-100 text-blue-600': req.type === 'supplies',
                                                    'bg-yellow-100 text-yellow-600': req.type === 'complaint',
                                                    'bg-gray-100 text-gray-600': req.type === 'other'
                                                }">
                                                <i :class="{
                                                    'ri-tools-line': req.type === 'repair',
                                                    'ri-shopping-cart-line': req.type === 'supplies',
                                                    'ri-megaphone-line': req.type === 'complaint',
                                                    'ri-question-line': req.type === 'other'
                                                }"></i>
                                            </div>
                                            <div class="ml-4">
                                                <div class="flex items-center">
                                                    <h4 class="text-sm font-bold text-gray-900 mr-2"
                                                        x-text="getTypeLabel(req.type)"></h4>
                                                    <span
                                                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                        :class="getStatusBadgeClass(req.status)" x-text="req.status">
                                                    </span>
                                                </div>
                                                <p class="text-sm text-gray-500 mt-1">
                                                    <span x-text="req.user_name"></span> • <span
                                                        x-text="req.created_at"></span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <template x-if="req.status === 'submitted'">
                                                <button @click="updateStatus(req.id, 'processing')"
                                                    class="px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                                    접수
                                                </button>
                                            </template>
                                            <template x-if="req.status === 'processing'">
                                                <button @click="updateStatus(req.id, 'done')"
                                                    class="px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none">
                                                    완료
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </li>
                            </template>
                            <template x-if="requests.length === 0">
                                <li class="px-6 py-12 text-center text-gray-500">
                                    요청 내역이 없습니다.
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>

                <!-- Branches Tab -->
                <div x-show="activeTab === 'branches'" x-data="branchesPage" class="space-y-6">
                    <!-- Branch List Header -->
                    <div
                        class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">지점 관리</h3>
                            <p class="text-sm text-gray-500 mt-1">전체 지점 및 연습실 현황을 관리합니다.</p>
                        </div>
                        <button @click="openCreateModal()"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none transition-all hover:shadow-lg hover:shadow-primary/30">
                            <i class="ri-add-line mr-2"></i>새 지점 등록
                        </button>
                    </div>

                    <!-- Branch Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="branch in branches" :key="branch.id">
                            <div
                                class="group bg-white rounded-2xl border border-gray-200 p-6 hover:shadow-xl hover:border-primary/30 transition-all duration-300 relative overflow-hidden">
                                <div
                                    class="absolute top-0 right-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1">
                                    <button @click="openEditModal(branch)"
                                        class="p-2 text-gray-400 hover:text-primary bg-white rounded-full shadow-sm hover:shadow"><i
                                            class="ri-edit-line"></i></button>
                                    <button @click="confirmDelete(branch)"
                                        class="p-2 text-gray-400 hover:text-red-500 bg-white rounded-full shadow-sm hover:shadow"><i
                                            class="ri-delete-bin-line"></i></button>
                                </div>

                                <div class="flex items-start mb-4">
                                    <div
                                        class="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center text-primary text-2xl mr-4">
                                        <i class="ri-building-line"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-bold text-gray-900" x-text="branch.name"></h4>
                                        <p class="text-sm text-gray-500 flex items-center mt-1">
                                            <i class="ri-map-pin-line mr-1 text-xs"></i>
                                            <span x-text="branch.address || '주소 없음'"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="space-y-3 mb-6">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-500">총 방 개수</span>
                                        <span class="font-bold text-gray-900"
                                            x-text="(branch.room_count || 0) + '개'"></span>
                                    </div>
                                    <div class="w-full bg-gray-100 rounded-full h-2">
                                        <div class="bg-primary h-2 rounded-full" style="width: 70%"></div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <button @click="loadBranchRooms(branch)"
                                        class="py-2.5 px-4 bg-gray-50 text-gray-700 font-medium rounded-xl hover:bg-primary hover:text-white transition-all duration-200 flex items-center justify-center">
                                        <i class="ri-layout-grid-line mr-2"></i>방 관리
                                    </button>
                                    <button @click="loadBranchServices(branch)"
                                        class="py-2.5 px-4 bg-gray-50 text-gray-700 font-medium rounded-xl hover:bg-secondary hover:text-white transition-all duration-200 flex items-center justify-center">
                                        <i class="ri-service-line mr-2"></i>서비스
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Modals (Include existing modal HTML structure here, simplified for brevity but fully functional) -->
                    <!-- Branch Modal -->
                    <div x-show="showModal" class="fixed inset-0 z-50 overflow-y-auto" x-cloak>
                        <div
                            class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"
                                @click="showModal = false"></div>
                            <div
                                class="inline-block overflow-hidden text-left align-bottom transition-all transform bg-white rounded-2xl shadow-xl sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                                <div class="px-4 pt-5 pb-4 bg-white sm:p-6 sm:pb-4">
                                    <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4"
                                        x-text="editMode ? '지점 수정' : '새 지점 등록'"></h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">지점명</label>
                                            <input type="text" x-model="formData.name"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">주소</label>
                                            <input type="text" x-model="formData.address"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">편의시설</label>
                                            <textarea x-model="formData.facilities" rows="3"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">설명</label>
                                            <textarea x-model="formData.description" rows="3"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="px-4 py-3 bg-gray-50 sm:px-6 sm:flex sm:flex-row-reverse">
                                    <button type="button" @click="saveBranch()"
                                        class="w-full px-4 py-2 text-base font-medium text-white bg-primary border border-transparent rounded-lg shadow-sm hover:bg-primary/90 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">저장</button>
                                    <button type="button" @click="showModal = false"
                                        class="w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Room Management Modal (Full Screen) -->
                    <div x-show="showRoomModal" class="fixed inset-0 z-50 overflow-hidden" x-cloak>
                        <div class="absolute inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"
                            @click="closeRoomModal()"></div>
                        <div class="fixed inset-0 z-10 overflow-y-auto">
                            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                                <div
                                    class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-7xl h-[90vh] flex flex-col">
                                    <!-- Header -->
                                    <div
                                        class="bg-white px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-900"
                                                x-text="currentBranch?.name + ' - 방 관리'"></h3>
                                            <p class="text-sm text-gray-500">층별 도면 및 방 배치를 관리합니다.</p>
                                        </div>
                                        <div class="flex items-center space-x-4">
                                            <div class="flex bg-gray-100 p-1 rounded-lg">
                                                <button @click="switchToList()"
                                                    :class="{'bg-white shadow text-gray-900': viewMode === 'list', 'text-gray-500 hover:text-gray-700': viewMode !== 'list'}"
                                                    class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"><i
                                                        class="ri-list-check mr-1"></i>목록</button>
                                                <button @click="switchToFloorPlan()"
                                                    :class="{'bg-white shadow text-gray-900': viewMode === 'floorplan', 'text-gray-500 hover:text-gray-700': viewMode !== 'floorplan'}"
                                                    class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"><i
                                                        class="ri-layout-2-line mr-1"></i>도면</button>
                                            </div>
                                            <button @click="closeRoomModal()"
                                                class="text-gray-400 hover:text-gray-500"><i
                                                    class="ri-close-line text-2xl"></i></button>
                                        </div>
                                    </div>

                                    <!-- Body -->
                                    <div class="flex-1 overflow-hidden flex flex-col bg-gray-50">
                                        <!-- Floor Selector -->
                                        <div
                                            class="bg-white px-6 py-3 border-b border-gray-200 flex items-center space-x-4 shadow-sm z-10">
                                            <span class="text-sm font-medium text-gray-700">층 선택:</span>
                                            <div class="flex space-x-2">
                                                <template x-for="floor in ['B1', '1F', '2F', '3F', '4F']">
                                                    <button @click="selectFloor(floor)"
                                                        :class="{'bg-primary text-white shadow-md shadow-primary/30': selectedFloor === floor, 'bg-white text-gray-600 border border-gray-200 hover:bg-gray-50': selectedFloor !== floor}"
                                                        class="px-4 py-1.5 text-sm font-medium rounded-lg transition-all"
                                                        x-text="floor">
                                                    </button>
                                                </template>
                                            </div>
                                            <div class="flex-1"></div>
                                            <button @click="openCreateRoomModal()"
                                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none">
                                                <i class="ri-add-line mr-1"></i>방 추가
                                            </button>
                                        </div>

                                        <!-- List View -->
                                        <div x-show="viewMode === 'list'" class="flex-1 overflow-y-auto p-6">
                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                <template
                                                    x-for="room in branchRooms.filter(r => r.floor === selectedFloor)"
                                                    :key="room.id">
                                                    <div
                                                        class="bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md transition-all">
                                                        <div class="flex justify-between items-start">
                                                            <div class="flex items-center">
                                                                <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center text-gray-600 font-bold mr-3"
                                                                    x-text="room.name.substring(0, 2)"></div>
                                                                <div>
                                                                    <h4 class="font-bold text-gray-900"
                                                                        x-text="room.name"></h4>
                                                                    <p class="text-xs text-gray-500"
                                                                        x-text="room.description || '설명 없음'"></p>
                                                                </div>
                                                            </div>
                                                            <div class="flex space-x-1">
                                                                <button @click="openEditRoomModal(room)"
                                                                    class="p-1.5 text-gray-400 hover:text-primary rounded-md hover:bg-gray-50"><i
                                                                        class="ri-edit-line"></i></button>
                                                                <button @click="confirmDeleteRoom(room)"
                                                                    class="p-1.5 text-gray-400 hover:text-red-500 rounded-md hover:bg-gray-50"><i
                                                                        class="ri-delete-bin-line"></i></button>
                                                            </div>
                                                        </div>
                                                        <div
                                                            class="mt-3 pt-3 border-t border-gray-100 flex justify-between items-center">
                                                            <span class="text-sm font-bold text-primary"
                                                                x-text="'₩' + (room.price || 0).toLocaleString()"></span>
                                                            <span
                                                                class="text-xs px-2 py-1 bg-gray-100 rounded text-gray-600"
                                                                x-text="room.status || 'available'"></span>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <!-- Floor Plan View -->
                                        <div x-show="viewMode === 'floorplan'"
                                            class="flex-1 overflow-hidden flex flex-col relative">
                                            <div
                                                class="bg-white border-b border-gray-200 px-6 py-2 flex justify-between items-center z-10">
                                                <div class="flex items-center space-x-4">
                                                    <label
                                                        class="flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors">
                                                        <i class="ri-upload-2-line mr-2"></i>도면 업로드
                                                        <input type="file" class="hidden" accept="image/*"
                                                            @change="uploadFloorPlan($event)">
                                                    </label>
                                                    <span class="text-xs text-gray-500" x-show="uploadingFloor">업로드
                                                        중...</span>
                                                </div>
                                                <button @click="saveRoomPositions()"
                                                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none transition-colors">
                                                    <i class="ri-save-line mr-1"></i>위치 저장
                                                </button>
                                            </div>

                                            <div class="flex-1 overflow-auto bg-gray-100 relative p-8 flex items-center justify-center"
                                                @mousemove="onDrag($event); onResize($event)"
                                                @mouseup="endDrag($event); endResize()">
                                                <template x-if="floorPlans[selectedFloor]">
                                                    <div class="relative bg-white shadow-2xl select-none ring-1 ring-black/5"
                                                        style="width: 800px; height: 600px;">
                                                        <img :src="floorPlans[selectedFloor]"
                                                            class="absolute inset-0 w-full h-full object-contain pointer-events-none"
                                                            alt="Floor Plan">
                                                        <template x-for="room in roomsByFloor[selectedFloor] || []"
                                                            :key="room.id">
                                                            <div class="absolute border-2 bg-primary/20 flex items-center justify-center cursor-grab group transition-colors hover:bg-primary/30 hover:z-10 rounded-sm backdrop-blur-sm"
                                                                :class="{'border-primary z-20 ring-2 ring-primary/50': draggedRoom?.id === room.id, 'border-primary/50': draggedRoom?.id !== room.id}"
                                                                :style="`left: ${room.position_x}%; top: ${room.position_y}%; width: ${room.width || 10}%; height: ${room.height || 10}%;`"
                                                                @mousedown="startDrag(room, $event)">
                                                                <span
                                                                    class="text-xs font-bold text-primary bg-white/90 px-1.5 py-0.5 rounded shadow-sm pointer-events-none select-none"
                                                                    x-text="room.name"></span>
                                                                <div class="absolute bottom-0 right-0 w-4 h-4 bg-primary cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity resize-handle rounded-tl-sm"
                                                                    @mousedown.stop="startResize(room, 'se', $event)">
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </template>
                                                <template x-if="!floorPlans[selectedFloor]">
                                                    <div class="text-center text-gray-500">
                                                        <div
                                                            class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                                                            <i class="ri-image-line text-4xl text-gray-400"></i>
                                                        </div>
                                                        <p class="text-lg font-medium text-gray-900">도면이 없습니다</p>
                                                        <p class="text-sm mt-1">도면 이미지를 업로드하여 방 배치를 시작하세요.</p>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Room Form Modal -->
                    <div x-show="showRoomFormModal" class="fixed inset-0 z-[60] overflow-y-auto" x-cloak>
                        <div
                            class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"
                                @click="showRoomFormModal = false"></div>
                            <div
                                class="inline-block overflow-hidden text-left align-bottom transition-all transform bg-white rounded-2xl shadow-xl sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                                <div class="px-4 pt-5 pb-4 bg-white sm:p-6 sm:pb-4">
                                    <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4"
                                        x-text="roomEditMode ? '방 수정' : '방 추가'"></h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">방 이름/번호</label>
                                            <input type="text" x-model="roomFormData.name"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">층</label>
                                            <select x-model="roomFormData.floor"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                                <option value="B1">B1</option>
                                                <option value="1F">1F</option>
                                                <option value="2F">2F</option>
                                                <option value="3F">3F</option>
                                                <option value="4F">4F</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">가격 (월)</label>
                                            <input type="number" x-model="roomFormData.price"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">설명</label>
                                            <textarea x-model="roomFormData.description" rows="3"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="px-4 py-3 bg-gray-50 sm:px-6 sm:flex sm:flex-row-reverse">
                                    <button type="button" @click="saveRoom()"
                                        class="w-full px-4 py-2 text-base font-medium text-white bg-primary border border-transparent rounded-lg shadow-sm hover:bg-primary/90 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">저장</button>
                                    <button type="button" @click="showRoomFormModal = false"
                                        class="w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Services Modal -->
                    <div x-show="showServicesModal" class="fixed inset-0 z-50 overflow-hidden" x-cloak>
                        <div class="absolute inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"
                            @click="closeServicesModal()"></div>
                        <div class="fixed inset-0 z-10 overflow-y-auto">
                            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                                <div
                                    class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl max-h-[90vh] flex flex-col">
                                    <div
                                        class="bg-white px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                        <h3 class="text-xl font-bold text-gray-900"
                                            x-text="currentBranch?.name + ' - 서비스 관리'"></h3>
                                        <button @click="closeServicesModal()"
                                            class="text-gray-400 hover:text-gray-500"><i
                                                class="ri-close-line text-2xl"></i></button>
                                    </div>
                                    <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                                        <!-- Common Services -->
                                        <div class="mb-8">
                                            <div class="flex justify-between items-center mb-4">
                                                <h4 class="text-lg font-bold text-gray-900">공용 서비스</h4>
                                                <button @click="openServiceForm('common')"
                                                    class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none">
                                                    <i class="ri-add-line mr-1"></i>추가
                                                </button>
                                            </div>
                                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                                <template x-for="service in commonServices" :key="service.id">
                                                    <div
                                                        class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm hover:shadow-md transition-all">
                                                        <div class="flex items-start justify-between">
                                                            <div class="flex items-center">
                                                                <div
                                                                    class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-primary text-xl mr-3">
                                                                    <i :class="service.icon || 'ri-star-line'"></i>
                                                                </div>
                                                                <div>
                                                                    <h5 class="text-sm font-bold text-gray-900"
                                                                        x-text="service.name"></h5>
                                                                    <p class="text-xs text-gray-500"
                                                                        x-text="service.description"></p>
                                                                </div>
                                                            </div>
                                                            <div class="flex space-x-1">
                                                                <button @click="editService(service)"
                                                                    class="text-gray-400 hover:text-primary p-1"><i
                                                                        class="ri-edit-line"></i></button>
                                                                <button @click="deleteService(service)"
                                                                    class="text-gray-400 hover:text-red-500 p-1"><i
                                                                        class="ri-delete-bin-line"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        <!-- Specialized Services -->
                                        <div>
                                            <div class="flex justify-between items-center mb-4">
                                                <h4 class="text-lg font-bold text-gray-900">특화 서비스</h4>
                                                <button @click="openServiceForm('specialized')"
                                                    class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-secondary hover:bg-secondary/90 focus:outline-none">
                                                    <i class="ri-add-line mr-1"></i>추가
                                                </button>
                                            </div>
                                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                                <template x-for="service in specializedServices" :key="service.id">
                                                    <div
                                                        class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm hover:shadow-md transition-all">
                                                        <div class="flex items-start justify-between">
                                                            <div class="flex items-center">
                                                                <div
                                                                    class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center text-secondary text-xl mr-3">
                                                                    <i :class="service.icon || 'ri-vip-crown-line'"></i>
                                                                </div>
                                                                <div>
                                                                    <h5 class="text-sm font-bold text-gray-900"
                                                                        x-text="service.name"></h5>
                                                                    <p class="text-xs text-gray-500"
                                                                        x-text="service.description"></p>
                                                                </div>
                                                            </div>
                                                            <div class="flex space-x-1">
                                                                <button @click="editService(service)"
                                                                    class="text-gray-400 hover:text-primary p-1"><i
                                                                        class="ri-edit-line"></i></button>
                                                                <button @click="deleteService(service)"
                                                                    class="text-gray-400 hover:text-red-500 p-1"><i
                                                                        class="ri-delete-bin-line"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Form Modal -->
                    <div x-show="showServiceFormModal" class="fixed inset-0 z-[60] overflow-y-auto" x-cloak>
                        <div
                            class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"
                                @click="showServiceFormModal = false"></div>
                            <div
                                class="inline-block overflow-hidden text-left align-bottom transition-all transform bg-white rounded-2xl shadow-xl sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                                <div class="px-4 pt-5 pb-4 bg-white sm:p-6 sm:pb-4">
                                    <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4"
                                        x-text="serviceEditMode ? '서비스 수정' : '서비스 추가'"></h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">서비스명</label>
                                            <input type="text" x-model="serviceFormData.name"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">아이콘
                                                (Remixicon)</label>
                                            <div class="flex mt-1 rounded-md shadow-sm">
                                                <input type="text" x-model="serviceFormData.icon"
                                                    class="flex-1 block w-full px-3 py-2 border border-gray-300 rounded-none rounded-l-lg focus:ring-primary focus:border-primary sm:text-sm"
                                                    placeholder="ri-wifi-line">
                                                <span
                                                    class="inline-flex items-center px-3 text-gray-500 border border-l-0 border-gray-300 bg-gray-50 rounded-r-lg sm:text-sm">
                                                    <i :class="serviceFormData.icon || 'ri-question-line'"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">설명</label>
                                            <textarea x-model="serviceFormData.description" rows="3"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">유형</label>
                                            <select x-model="serviceFormData.service_type"
                                                class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                                                <option value="common">공용 서비스</option>
                                                <option value="specialized">특화 서비스</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="px-4 py-3 bg-gray-50 sm:px-6 sm:flex sm:flex-row-reverse">
                                    <button type="button" @click="saveService()"
                                        class="w-full px-4 py-2 text-base font-medium text-white bg-primary border border-transparent rounded-lg shadow-sm hover:bg-primary/90 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">저장</button>
                                    <button type="button" @click="showServiceFormModal = false"
                                        class="w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
</body>

</html>