<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연습실 관리 시스템 - 관리자 대시보드</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <script>
        // Check admin authentication before page loads
        (function () {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('로그인이 필요합니다.');
                window.location.href = '/login';
                return;
            }

            // Verify admin role
            fetch('/api/auth/me', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Invalid token');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.role !== 'admin') {
                        alert('관리자 권한이 필요합니다.');
                        window.location.href = '/my/room';
                    }
                })
                .catch(error => {
                    console.error('Auth error:', error);
                    alert('인증에 실패했습니다. 다시 로그인해주세요.');
                    localStorage.removeItem('token');
                    window.location.href = '/login';
                });
        })();

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6'
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .rounded-button {
            border-radius: 0.5rem;
        }
    </style>
</head>

<body class="bg-gray-50" x-data="{ activeTab: 'dashboard', sidebarOpen: false }">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="hidden lg:flex lg:flex-shrink-0">
            <div class="flex flex-col w-64 bg-white border-r border-gray-200">
                <div class="flex items-center justify-center h-16 px-4 border-b border-gray-200">
                    <h1 class="text-2xl font-bold text-primary" style="font-family: 'Pacifico', cursive;">Eroom</h1>
                </div>
                <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                    <ul class="space-y-1">
                        <li>
                            <a href="#" @click.prevent="activeTab = 'dashboard'"
                                :class="{'bg-primary/10 text-primary': activeTab === 'dashboard', 'text-gray-700 hover:bg-gray-100': activeTab !== 'dashboard'}"
                                class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors">
                                <div class="w-5 h-5 flex items-center justify-center"><i class="ri-dashboard-line"></i>
                                </div>
                                <span class="font-medium">대시보드</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" @click.prevent="activeTab = 'contracts'"
                                :class="{'bg-primary/10 text-primary': activeTab === 'contracts', 'text-gray-700 hover:bg-gray-100': activeTab !== 'contracts'}"
                                class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors">
                                <div class="w-5 h-5 flex items-center justify-center"><i class="ri-file-list-line"></i>
                                </div>
                                <span class="font-medium">계약 관리</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" @click.prevent="activeTab = 'requests'"
                                :class="{'bg-primary/10 text-primary': activeTab === 'requests', 'text-gray-700 hover:bg-gray-100': activeTab !== 'requests'}"
                                class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors">
                                <div class="w-5 h-5 flex items-center justify-center"><i
                                        class="ri-question-answer-line"></i></div>
                                <span class="font-medium">요청 관리</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" @click.prevent="activeTab = 'branches'"
                                :class="{'bg-primary/10 text-primary': activeTab === 'branches', 'text-gray-700 hover:bg-gray-100': activeTab !== 'branches'}"
                                class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors">
                                <div class="w-5 h-5 flex items-center justify-center"><i class="ri-building-2-line"></i>
                                </div>
                                <span class="font-medium">지점 관리</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="p-4 border-t border-gray-200">
                    <div class="flex items-center space-x-3 px-3 py-2">
                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                            <i class="ri-user-line text-gray-600"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">관리자</p>
                            <p class="text-xs text-gray-500 truncate">admin@eroom.kr</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button @click="sidebarOpen = !sidebarOpen"
                            class="text-gray-500 hover:text-gray-700 focus:outline-none lg:hidden">
                            <i class="ri-menu-line text-2xl"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-900"
                            x-text="activeTab === 'dashboard' ? '대시보드' : (activeTab === 'contracts' ? '계약 관리' : (activeTab === 'requests' ? '요청 관리' : '지점 관리'))">
                        </h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-sm text-gray-500 hover:text-primary">메인으로</a>
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                <i class="ri-user-line text-white"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-700">관리자</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Tab -->
            <div x-show="activeTab === 'dashboard'" class="flex-1 overflow-auto p-6">
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">총 방 수</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2">124</p>
                                <p class="text-sm text-green-600 mt-1"><span class="inline-flex items-center"><i
                                            class="ri-arrow-up-line mr-1"></i> +2.5%</span></p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><i
                                    class="ri-home-4-line text-blue-600 text-xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">사용 중</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2">89</p>
                                <p class="text-sm text-gray-500 mt-1">점유율 71.8%</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"><i
                                    class="ri-check-line text-green-600 text-xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">활성 계약</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2">89</p>
                                <p class="text-sm text-orange-600 mt-1">7개 만료 임박</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"><i
                                    class="ri-file-text-line text-purple-600 text-xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">이번 달 매출</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2">₩45.2M</p>
                                <p class="text-sm text-green-600 mt-1"><span class="inline-flex items-center"><i
                                            class="ri-arrow-up-line mr-1"></i> +12.3%</span></p>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center"><i
                                    class="ri-money-dollar-circle-line text-emerald-600 text-xl"></i></div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">매출 추이</h3>
                        </div>
                        <div id="revenueChart" class="h-80"></div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">방 상태 분포</h3>
                        </div>
                        <div id="roomStatusChart" class="h-80"></div>
                    </div>
                </div>
            </div>

            <!-- Contracts Tab -->
            <div x-show="activeTab === 'contracts'" class="flex-1 overflow-auto p-6" x-cloak x-data="{ contracts: [] }"
                x-init="fetch('/api/admin/contracts', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('token')}}).then(r => r.json()).then(d => contracts = d)">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">계약 목록</h3>
                        <button class="rounded-button px-4 py-2 bg-primary text-white text-sm hover:bg-primary/90">신규
                            계약</button>
                    </div>
                    <div class="border-t border-gray-200">
                        <ul class="divide-y divide-gray-200">
                            <template x-for="contract in contracts" :key="contract.id">
                                <li class="px-4 py-4 sm:px-6 hover:bg-gray-50">
                                    <div class="flex items-center justify-between">
                                        <div class="text-sm font-medium text-primary truncate"
                                            x-text="contract.user_name"></div>
                                        <div class="ml-2 flex-shrink-0 flex">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                :class="{'bg-green-100 text-green-800': contract.status === 'active', 'bg-yellow-100 text-yellow-800': contract.status === 'requested', 'bg-red-100 text-red-800': contract.status === 'cancelled'}"
                                                x-text="contract.status"></span>
                                        </div>
                                    </div>
                                    <div class="mt-2 sm:flex sm:justify-between">
                                        <div class="sm:flex">
                                            <p class="flex items-center text-sm text-gray-500">
                                                <i class="ri-home-4-line mr-2"></i>
                                                <span x-text="contract.room_name"></span>
                                                <span class="mx-2">|</span>
                                                <i class="ri-calendar-line mr-2"></i>
                                                <span x-text="contract.start_date + ' ~ ' + contract.end_date"></span>
                                            </p>
                                        </div>
                                        <div class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0 space-x-2">
                                            <button @click="updateContractStatus(contract.id, 'active')"
                                                class="text-primary hover:text-primary/80 font-medium">승인</button>
                                            <button @click="updateContractStatus(contract.id, 'cancelled')"
                                                class="text-red-600 hover:text-red-800 font-medium">거절</button>
                                        </div>
                                    </div>
                                </li>
                            </template>
                            <template x-if="contracts.length === 0">
                                <li class="px-4 py-8 text-center text-gray-500">계약 내역이 없습니다.</li>
                            </template>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Requests Tab -->
            <div x-show="activeTab === 'requests'" class="flex-1 overflow-auto p-6" x-cloak x-data="{ requests: [] }"
                x-init="fetch('/api/admin/requests', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('token')}}).then(r => r.json()).then(d => requests = d)">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">요청 목록</h3>
                    </div>
                    <div class="border-t border-gray-200">
                        <ul class="divide-y divide-gray-200">
                            <template x-for="req in requests" :key="req.id">
                                <li class="px-4 py-4 sm:px-6 hover:bg-gray-50">
                                    <div class="flex items-center justify-between">
                                        <div class="text-sm font-medium text-primary truncate" x-text="req.type"></div>
                                        <div class="ml-2 flex-shrink-0 flex">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                :class="{'bg-green-100 text-green-800': req.status === 'done', 'bg-yellow-100 text-yellow-800': req.status === 'submitted', 'bg-blue-100 text-blue-800': req.status === 'processing'}"
                                                x-text="req.status"></span>
                                        </div>
                                    </div>
                                    <div class="mt-2 sm:flex sm:justify-between">
                                        <div class="sm:flex">
                                            <p class="flex items-center text-sm text-gray-500">
                                                <i class="ri-user-line mr-2"></i>
                                                <span x-text="req.user_name"></span>
                                            </p>
                                        </div>
                                        <div class="mt-2 flex items-center text-sm text-gray-500 sm:mt-0 space-x-2">
                                            <button @click="updateRequestStatus(req.id, 'processing')"
                                                class="text-primary hover:text-primary/80 font-medium">처리중</button>
                                            <button @click="updateRequestStatus(req.id, 'done')"
                                                class="text-green-600 hover:text-green-800 font-medium">완료</button>
                                        </div>
                                    </div>
                                </li>
                            </template>
                            <template x-if="requests.length === 0">
                                <li class="px-4 py-8 text-center text-gray-500">요청 내역이 없습니다.</li>
                            </template>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Branches Tab -->
            <div x-show="activeTab === 'branches'" class="flex-1 overflow-auto p-6" x-cloak x-data="{
                branches: [],
                showModal: false,
                showDeleteConfirm: false,
                showRoomModal: false,
                showRoomFormModal: false,
                    this.roomFormData = { ...room };
                    this.showRoomFormModal = true;
                },

                confirmDeleteRoom(room) {
                    this.currentRoom = room;
                    this.showRoomDeleteConfirm = true;
                },

                async saveRoom() {
                    const token = localStorage.getItem('token');
                    const url = this.roomEditMode ? `/api/admin/rooms/${this.currentRoom.id}` : '/api/admin/rooms';
                    const method = this.roomEditMode ? 'PUT' : 'POST';

                    const payload = this.roomEditMode 
                        ? this.roomFormData 
                        : { ...this.roomFormData, branch_id: this.currentBranch.id };

                    try {
                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer ' + token
                            },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            this.showRoomFormModal = false;
                            await this.loadBranchRooms(this.currentBranch);
                        } else {
                            const data = await response.json();
                            alert(data.error || '방 저장에 실패했습니다.');
                        }
                    } catch (error) {
                        console.error('Error saving room:', error);
                        alert('오류가 발생했습니다.');
                    }
                },

                async deleteRoom() {
                    const token = localStorage.getItem('token');
                    try {
                        const response = await fetch(`/api/admin/rooms/${this.currentRoom.id}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': 'Bearer ' + token }
                        });

                        if (response.ok) {
                            this.showRoomDeleteConfirm = false;
                            await this.loadBranchRooms(this.currentBranch);
                        } else {
                            const data = await response.json();
                            alert(data.error || '방 삭제에 실패했습니다.');
                        }
                    } catch (error) {
                        console.error('Error deleting room:', error);
                        alert('오류가 발생했습니다.');
                    }
                }
            }">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">지점 목록</h3>
                        <button @click="openCreateModal()"
                            class="rounded-button px-4 py-2 bg-primary text-white text-sm hover:bg-primary/90">
                            <i class="ri-add-line mr-1"></i>새 지점 등록
                        </button>
                    </div>
                    <div class="border-t border-gray-200 p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <template x-for="branch in branches" :key="branch.id">
                                <div
                                    class="group relative bg-white border border-gray-200 rounded-xl p-5 hover:shadow-lg transition-all duration-300 hover:border-primary/30">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h4 class="text-lg font-bold text-gray-900 mb-1" x-text="branch.name"></h4>
                                            <p class="text-sm text-gray-500 flex items-center">
                                                <i class="ri-map-pin-line mr-1"></i>
                                                <span x-text="branch.address || '주소 없음'"></span>
                                            </p>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button @click="openEditModal(branch)"
                                                class="px-2 py-1 text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded transition-colors">
                                                수정
                                            </button>
                                            <button @click="confirmDelete(branch)"
                                                class="px-2 py-1 text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 rounded transition-colors">
                                                삭제
                                            </button>
                                        </div>
                                    </div>

                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center text-sm text-gray-600">
                                            <i class="ri-door-open-line mr-2 text-gray-400"></i>
                                            <span>총 방 개수: <span class="font-semibold text-gray-900"
                                                    x-text="branch.room_count || 0"></span>개</span>
                                        </div>
                                    </div>

                                    <button @click="loadBranchRooms(branch)"
                                        class="w-full py-2 bg-gray-50 text-primary font-medium rounded-lg hover:bg-primary hover:text-white transition-all duration-200 flex items-center justify-center group-hover:bg-primary group-hover:text-white">
                                        <span>방 관리</span>
                                        <i
                                            class="ri-arrow-right-line ml-2 transition-transform group-hover:translate-x-1"></i>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Room Management Modal -->
                <div x-show="showRoomModal" class="fixed inset-0 z-50 overflow-hidden" aria-labelledby="modal-title"
                    role="dialog" aria-modal="true" x-cloak>
                    <div class="absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                        @click="closeRoomModal()"></div>

                    <div class="fixed inset-0 z-10 overflow-y-auto">
                        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                            <div
                                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-7xl h-[90vh] flex flex-col">
                                <div
                                    class="bg-white px-4 py-3 sm:px-6 border-b border-gray-200 flex justify-between items-center">
                                    <h3 class="text-lg font-semibold leading-6 text-gray-900" id="modal-title">
                                        <span x-text="currentBranch?.name"></span> - 방 관리
                                    </h3>
                                    <button type="button"
                                        class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none"
                                        @click="closeRoomModal()">
                                        <span class="sr-only">Close</span>
                                        <i class="ri-close-line text-2xl"></i>
                                    </button>
                                </div>

                                <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                                    <div class="mb-4 flex justify-between items-center">
                                        <h4 class="text-base font-semibold text-gray-900">방 목록</h4>
                                        <button @click="openCreateRoomModal()"
                                            class="rounded-button px-4 py-2 bg-primary text-white text-sm hover:bg-primary/90">
                                            <i class="ri-add-line mr-1"></i>새 방 등록
                                        </button>
                                    </div>

                                    <ul class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                                        <template x-for="room in branchRooms" :key="room.id">
                                            <li class="col-span-1 divide-y divide-gray-200 rounded-lg bg-white shadow">
                                                <div class="flex w-full items-center justify-between space-x-6 p-6">
                                                    <div class="flex-1 truncate">
                                                        <div class="flex items-center space-x-3">
                                                            <h3 class="truncate text-sm font-medium text-gray-900"
                                                                x-text="room.name"></h3>
                                                            <span
                                                                class="inline-flex flex-shrink-0 items-center rounded-full px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset"
                                                                :class="room.status === 'available' ? 'bg-green-50 text-green-700 ring-green-600/20' : 'bg-red-50 text-red-700 ring-red-600/20'"
                                                                x-text="room.status === 'available' ? '빈 방' : '사용 중'"></span>
                                                        </div>
                                                        <p class="mt-1 truncate text-sm text-gray-500"
                                                            x-text="room.description || '설명 없음'"></p>
                                                        <p class="mt-1 text-sm font-medium text-gray-900"
                                                            x-text="'₩' + room.price.toLocaleString() + '/월'"></p>
                                                    </div>
                                                </div>
                                                <div class="-mt-px flex divide-x divide-gray-200">
                                                    <div class="flex w-0 flex-1">
                                                        <button @click="openEditRoomModal(room)"
                                                            class="relative -mr-px inline-flex w-0 flex-1 items-center justify-center gap-x-3 rounded-bl-lg border border-transparent py-4 text-sm font-semibold text-gray-900 hover:bg-gray-50">
                                                            <i class="ri-edit-line text-gray-400"></i>
                                                            수정
                                                        </button>
                                                    </div>
                                                    <div class="flex w-0 flex-1">
                                                        <button @click="confirmDeleteRoom(room)"
                                                            class="relative inline-flex w-0 flex-1 items-center justify-center gap-x-3 rounded-br-lg border border-transparent py-4 text-sm font-semibold text-gray-900 hover:bg-gray-50">
                                                            <i class="ri-delete-bin-line text-gray-400"></i>
                                                            삭제
                                                        </button>
                                                    </div>
                                                </div>
                                            </li>
                                        </template>
                                        <template x-if="branchRooms.length === 0">
                                            <li class="col-span-full py-8 text-center text-gray-500">
                                                등록된 방이 없습니다.
                                            </li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room Create/Edit Modal -->
                <div x-show="showRoomFormModal"
                    class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-[60] flex items-center justify-center"
                    @click.self="showRoomFormModal = false" x-transition.opacity x-cloak>
                    <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"
                        x-transition.scale>
                        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                            <h3 class="text-lg font-bold text-gray-900" x-text="roomEditMode ? '방 정보 수정' : '새로운 방 등록'">
                            </h3>
                            <button @click="showRoomFormModal = false"
                                class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="ri-close-line text-2xl"></i>
                            </button>
                        </div>

                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">방 이름 <span
                                        class="text-red-500">*</span></label>
                                <div class="relative">
                                    <i class="ri-door-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" x-model="roomFormData.name"
                                        class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                        placeholder="예: 101호">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">월 임대료 <span
                                        class="text-red-500">*</span></label>
                                <div class="relative">
                                    <i
                                        class="ri-money-dollar-circle-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    <input type="number" x-model="roomFormData.price"
                                        class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                        placeholder="500000">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">방 설명</label>
                                <div class="relative">
                                    <i class="ri-file-text-line absolute left-3 top-3 text-gray-400"></i>
                                    <textarea x-model="roomFormData.description" rows="3"
                                        class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all resize-none"
                                        placeholder="방에 대한 간단한 설명을 입력하세요"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end space-x-3">
                            <button @click="showRoomFormModal = false"
                                class="px-5 py-2.5 bg-white text-gray-700 font-medium rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors shadow-sm">
                                취소
                            </button>
                            <button @click="saveRoom()"
                                class="px-5 py-2.5 bg-primary text-white font-medium rounded-lg hover:bg-primary/90 transition-colors shadow-sm flex items-center">
                                <i class="ri-save-line mr-2"></i>
                                <span x-text="roomEditMode ? '수정사항 저장' : '방 등록하기'"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Room Delete Confirmation Modal -->
                <div x-show="showRoomDeleteConfirm"
                    class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-[60] flex items-center justify-center"
                    @click.self="showRoomDeleteConfirm = false" x-transition.opacity x-cloak>
                    <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 p-6 text-center"
                        x-transition.scale>
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="ri-delete-bin-line text-3xl text-red-500"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">방 삭제</h3>
                        <p class="text-gray-500 mb-6">
                            <span class="font-semibold text-gray-900" x-text="currentRoom?.name"></span>을(를) 정말
                            삭제하시겠습니까?<br>
                            <span class="text-xs text-red-500 mt-1 block">* 활성 계약이 있는 방은 삭제할 수 없습니다.</span>
                        </p>

                        <div class="flex justify-center space-x-3">
                            <button @click="showRoomDeleteConfirm = false"
                                class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors">
                                취소
                            </button>
                            <button @click="deleteRoom()"
                                class="flex-1 px-4 py-2.5 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-colors">
                                삭제하기
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Branch Create/Edit Modal -->
                <div x-show="showModal"
                    class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center"
                    @click.self="showModal = false" x-transition.opacity x-cloak>
                    <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 overflow-hidden"
                        x-transition.scale>
                        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                            <h3 class="text-lg font-bold text-gray-900" x-text="editMode ? '지점 정보 수정' : '새로운 지점 등록'">
                            </h3>
                            <button @click="showModal = false"
                                class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="ri-close-line text-2xl"></i>
                            </button>
                        </div>

                        <div class="p-6 space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="col-span-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">지점명 <span
                                            class="text-red-500">*</span></label>
                                    <div class="relative">
                                        <i
                                            class="ri-building-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        <input type="text" x-model="formData.name"
                                            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                            placeholder="예: 강남 1호점">
                                    </div>
                                </div>

                                <div class="col-span-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">주소</label>
                                    <div class="relative">
                                        <i
                                            class="ri-map-pin-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        <input type="text" x-model="formData.address"
                                            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
                                            placeholder="지점의 상세 주소를 입력하세요">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">시설 정보</label>
                                    <div class="relative">
                                        <i class="ri-parking-box-line absolute left-3 top-3 text-gray-400"></i>
                                        <textarea x-model="formData.facilities" rows="4"
                                            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all resize-none"
                                            placeholder="주차장, 와이파이, 정수기 등"></textarea>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">지점 설명</label>
                                    <div class="relative">
                                        <i class="ri-file-text-line absolute left-3 top-3 text-gray-400"></i>
                                        <textarea x-model="formData.description" rows="4"
                                            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all resize-none"
                                            placeholder="지점에 대한 간단한 소개를 입력하세요"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end space-x-3">
                            <button @click="showModal = false"
                                class="px-5 py-2.5 bg-white text-gray-700 font-medium rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors shadow-sm">
                                취소
                            </button>
                            <button @click="saveBranch()"
                                class="px-5 py-2.5 bg-primary text-white font-medium rounded-lg hover:bg-primary/90 transition-colors shadow-sm flex items-center">
                                <i class="ri-save-line mr-2"></i>
                                <span x-text="editMode ? '수정사항 저장' : '지점 등록하기'"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Branch Delete Confirmation Modal -->
                <div x-show="showDeleteConfirm"
                    class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center"
                    @click.self="showDeleteConfirm = false" x-transition.opacity x-cloak>
                    <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 p-6 text-center"
                        x-transition.scale>
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="ri-delete-bin-line text-3xl text-red-500"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">지점 삭제</h3>
                        <p class="text-gray-500 mb-6">
                            <span class="font-semibold text-gray-900" x-text="currentBranch?.name"></span>을(를) 정말
                            삭제하시겠습니까?<br>
                            <span class="text-xs text-red-500 mt-1 block">* 방이 있는 지점은 삭제할 수 없습니다.</span>
                        </p>

                        <div class="flex justify-center space-x-3">
                            <button @click="showDeleteConfirm = false"
                                class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors">
                                취소
                            </button>
                            <button @click="deleteBranch()"
                                class="flex-1 px-4 py-2.5 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-colors">
                                삭제하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Revenue Chart
            const revenueChart = echarts.init(document.getElementById('revenueChart'));
            const revenueOption = {
                animation: false,
                grid: { top: 10, left: 0, right: 0, bottom: 0, containLabel: true },
                xAxis: {
                    type: 'category', data: ['7월', '8월', '9월', '10월', '11월', '12월', '1월'], axisLine: {
                        show: false
                    }, axisTick: { show: false }
                },
                yAxis: {
                    type: 'value', axisLine: { show: false }, axisTick: { show: false }, splitLine: {
                        lineStyle: { color: '#f3f4f6' }
                    }
                },
                series: [{
                    data: [38.5, 41.2, 39.8, 43.1, 44.6, 42.3, 45.2],
                    type: 'line',
                    smooth: true,
                    symbol: 'none',
                    lineStyle: { color: 'rgba(59, 130, 246, 1)', width: 3 },
                    areaStyle: {
                        color: {
                            type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{
                                offset: 0, color:
                                    'rgba(59, 130, 246, 0.1)'
                            }, { offset: 1, color: 'rgba(59, 130, 246, 0.01)' }]
                        }
                    }
                }],
                tooltip: { trigger: 'axis' }
            };
            revenueChart.setOption(revenueOption);

            // Room Status Chart
            const roomStatusChart = echarts.init(document.getElementById('roomStatusChart'));
            const roomStatusOption = {
                animation: false,
                tooltip: { trigger: 'item' },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['50%', '50%'],
                    data: [
                        { value: 89, name: '사용 중', itemStyle: { color: 'rgba(59, 130, 246, 1)' } },
                        { value: 35, name: '빈 방', itemStyle: { color: 'rgba(139, 92, 246, 1)' } }
                    ],
                    itemStyle: { borderRadius: 8 }
                }]
            };
            roomStatusChart.setOption(roomStatusOption);

            // Resize charts on window resize
            window.addEventListener('resize', function () {
                revenueChart.resize();
                roomStatusChart.resize();
            });
        });

        // API Functions
        function updateContractStatus(id, status) {
            fetch('/api/admin/contracts/' + id + '/status', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json', 'Authorization': 'Bearer ' +
                        localStorage.getItem('token')
                },
                body: JSON.stringify({ status: status })
            }).then(() => { window.location.reload(); });
        }

        function updateRequestStatus(id, status) {
            fetch('/api/admin/requests/' + id + '/status', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json', 'Authorization': 'Bearer ' +
                        localStorage.getItem('token')
                },
                body: JSON.stringify({ status: status })
            }).then(() => { window.location.reload(); });
        }
    </script>
</body>

</html>