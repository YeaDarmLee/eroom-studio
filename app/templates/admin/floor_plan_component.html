<!-- Floor Plan Management UI Component -->
<!-- This component should be included in the Room Management Modal -->

<style>
    .floor-plan-container {
        position: relative;
        width: 100%;
        height: 600px;
        background-color: #f3f4f6;
        background-image:
            linear-gradient(rgba(0, 0, 0, .05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 0, 0, .05) 1px, transparent 1px);
        background-size: 20px 20px;
        overflow: hidden;
        border-radius: 0.5rem;
    }

    .floor-plan-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none;
    }

    .room-box {
        position: absolute;
        background-color: rgba(59, 130, 246, 0.3);
        border: 2px solid #3b82f6;
        border-radius: 0.375rem;
        cursor: grab;
        transition: box-shadow 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 0.5rem;
    }

    .room-box:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        background-color: rgba(59, 130, 246, 0.4);
    }

    .room-box.dragging {
        cursor: grabbing;
        opacity: 0.8;
        z-index: 1000;
    }

    .room-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #1e40af;
        pointer-events: none;
        user-select: none;
    }

    .resize-handle {
        position: absolute;
        width: 12px;
        height: 12px;
        background-color: #3b82f6;
        border: 2px solid white;
        border-radius: 50%;
        cursor: nwse-resize;
    }

    .resize-handle.se {
        bottom: -6px;
        right: -6px;
    }

    .floor-tab {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
    }

    .floor-tab.active {
        background-color: #3b82f6;
        color: white;
    }

    .floor-tab:not(.active) {
        background-color: #e5e7eb;
        color: #6b7280;
    }

    .floor-tab:not(.active):hover {
        background-color: #d1d5db;
    }
</style>

<!-- View Mode Toggle -->
<div class="mb-4 flex justify-between items-center border-b border-gray-200 pb-4">
    <div class="flex space-x-2">
        <button @click="switchToList()"
            :class="viewMode === 'list' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
            class="px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
            <i class="ri-list-check mr-2"></i>
            목록 보기
        </button>
        <button @click="switchToFloorPlan()"
            :class="viewMode === 'floorplan' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
            class="px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
            <i class="ri-layout-grid-line mr-2"></i>
            도면 관리
        </button>
    </div>
    <button @click="openCreateRoomModal()"
        class="rounded-button px-4 py-2 bg-primary text-white text-sm hover:bg-primary/90">
        <i class="ri-add-line mr-1"></i>새 방 등록
    </button>
</div>

<!-- List View (Original) -->
<div x-show="viewMode === 'list'">
    <ul class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <template x-for="room in branchRooms" :key="room.id">
            <li class="col-span-1 divide-y divide-gray-200 rounded-lg bg-white shadow">
                <div class="flex w-full items-center justify-between space-x-6 p-6">
                    <div class="flex-1 truncate">
                        <div class="flex items-center space-x-3">
                            <h3 class="truncate text-sm font-medium text-gray-900" x-text="room.name"></h3>
                            <span
                                class="inline-flex flex-shrink-0 items-center rounded-full px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset"
                                :class="room.status === 'available' ? 'bg-green-50 text-green-700 ring-green-600/20' : 'bg-red-50 text-red-700 ring-red-600/20'"
                                x-text="room.status === 'available' ? '빈 방' : '사용 중'"></span>
                        </div>
                        <p class="mt-1 truncate text-sm text-gray-500" x-text="room.description || '설명 없음'"></p>
                        <p class="mt-1 text-sm font-medium text-gray-900"
                            x-text="'₩' + room.price.toLocaleString() + '/월'"></p>
                        <p class="mt-1 text-xs text-gray-500" x-text="'층: ' + (room.floor || '1F')"></p>
                    </div>
                </div>
                <div class="-mt-px flex divide-x divide-gray-200">
                    <div class="flex w-0 flex-1">
                        <button @click="openEditRoomModal(room)"
                            class="relative -mr-px inline-flex w-0 flex-1 items-center justify-center gap-x-3 rounded-bl-lg border border-transparent py-4 text-sm font-semibold text-gray-900 hover:bg-gray-50">
                            <i class="ri-edit-line text-gray-400"></i>
                            수정
                        </button>
                    </div>
                    <div class="flex w-0 flex-1">
                        <button @click="confirmDeleteRoom(room)"
                            class="relative inline-flex w-0 flex-1 items-center justify-center gap-x-3 rounded-br-lg border border-transparent py-4 text-sm font-semibold text-gray-900 hover:bg-gray-50">
                            <i class="ri-delete-bin-line text-gray-400"></i>
                            삭제
                        </button>
                    </div>
                </div>
            </li>
        </template>
        <template x-if="branchRooms.length === 0">
            <li class="col-span-full py-8 text-center text-gray-500">
                등록된 방이 없습니다.
            </li>
        </template>
    </ul>
</div>

<!-- Floor Plan View (New) -->
<div x-show="viewMode === 'floorplan'" class="space-y-4">
    <!-- Floor Tabs -->
    <div class="flex flex-wrap gap-2">
        <template x-for="floor in ['B2', 'B1', '1F', '2F', '3F', '4F', '5F', '6F']" :key="floor">
            <button @click="selectFloor(floor)" :class="selectedFloor === floor ? 'active' : ''" class="floor-tab"
                x-text="floor">
            </button>
        </template>
    </div>

    <!-- Floor Plan Upload Section -->
    <div class="bg-white rounded-lg border-2 border-dashed border-gray-300 p-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="flex-shrink-0">
                    <i class="ri-image-add-line text-4xl text-gray-400"></i>
                </div>
                <div>
                    <h4 class="text-sm font-semibold text-gray-900" x-text="selectedFloor + ' 도면'"></h4>
                    <p class="text-xs text-gray-500">PNG, JPG 파일을 업로드하세요</p>
                    <p class="text-xs text-gray-400 mt-1" x-show="floorPlans[selectedFloor]">
                        현재 도면: <span x-text="floorPlans[selectedFloor]"></span>
                    </p>
                </div>
            </div>
            <div>
                <label
                    class="cursor-pointer inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="ri-upload-2-line mr-2"></i>
                    <span x-text="uploadingFloor === selectedFloor ? '업로드 중...' : '도면 업로드'"></span>
                    <input type="file" accept="image/*" class="hidden" @change="uploadFloorPlan($event)"
                        :disabled="uploadingFloor === selectedFloor">
                </label>
            </div>
        </div>
    </div>

    <!-- Interactive Floor Plan Canvas -->
    <div class="bg-white rounded-lg p-4 shadow-sm">
        <div class="flex justify-between items-center mb-4">
            <h4 class="text-sm font-semibold text-gray-900">
                <span x-text="selectedFloor"></span> 방 배치
                <span class="text-xs text-gray-500 ml-2"
                    x-text="'(' + (roomsByFloor[selectedFloor]?.length || 0) + '개)'"></span>
            </h4>
            <button @click="saveRoomPositions()"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center text-sm font-medium">
                <i class="ri-save-line mr-2"></i>
                위치 저장
            </button>
        </div>

        <div class="floor-plan-container"
            @mousemove="isDragging ? onDrag($event) : (isResizing ? onResize($event) : null)"
            @mouseup="endDrag($event); endResize()" @mouseleave="endDrag($event); endResize()">

            <!-- Floor Plan Background Image -->
            <img x-show="floorPlans[selectedFloor]" :src="floorPlans[selectedFloor]" class="floor-plan-image"
                alt="Floor Plan">

            <!-- No Floor Plan Message -->
            <div x-show="!floorPlans[selectedFloor]" class="absolute inset-0 flex items-center justify-center">
                <div class="text-center">
                    <i class="ri-image-line text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 font-medium">도면을 먼저 업로드해주세요</p>
                    <p class="text-gray-400 text-sm mt-2">위의 "도면 업로드" 버튼을 클릭하세요</p>
                </div>
            </div>

            <!-- Room Boxes -->
            <template x-for="room in (roomsByFloor[selectedFloor] || [])" :key="room.id">
                <div class="room-box" :class="{ 'dragging': isDragging && draggedRoom?.id === room.id }"
                    :style="`left: ${room.position_x || 0}%; top: ${room.position_y || 0}%; width: ${room.width || 10}%; height: ${room.height || 10}%;`"
                    @mousedown="startDrag(room, $event)">

                    <div class="room-label">
                        <div x-text="room.name"></div>
                        <div class="text-xs opacity-75" x-text="'₩' + (room.price / 10000) + '만'"></div>
                    </div>

                    <!-- Resize Handle -->
                    <div class="resize-handle se" @mousedown="startResize(room, 'se', $event)">
                    </div>
                </div>
            </template>

            <!-- No Rooms Message -->
            <div x-show="floorPlans[selectedFloor] && (!roomsByFloor[selectedFloor] || roomsByFloor[selectedFloor].length === 0)"
                class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <div class="text-center bg-white/90 p-6 rounded-lg">
                    <i class="ri-door-line text-4xl text-gray-300 mb-2"></i>
                    <p class="text-gray-500 font-medium">이 층에 등록된 방이 없습니다</p>
                    <p class="text-gray-400 text-sm mt-1">방을 생성할 때 층을 <span class="font-semibold"
                            x-text="selectedFloor"></span>로 선택하세요</p>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex">
                <i class="ri-information-line text-blue-600 mr-3 mt-0.5"></i>
                <div class="text-sm text-blue-800">
                    <p class="font-semibold mb-2">사용 방법:</p>
                    <ul class="list-disc list-inside space-y-1 text-xs">
                        <li>방 박스를 <strong>드래그</strong>하여 위치를 조정하세요</li>
                        <li>방 박스 우측 하단의 <strong>핸들</strong>을 드래그하여 크기를 조정하세요</li>
                        <li>변경사항은 <strong>"위치 저장"</strong> 버튼을 눌러야 저장됩니다</li>
                        <li>방 생성 시 층을 올바르게 선택해야 해당 층에 표시됩니다</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>